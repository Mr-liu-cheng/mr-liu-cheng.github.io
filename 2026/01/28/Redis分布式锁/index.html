<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Redis分布式锁 | LiuCheng's Blog</title><meta name="author" content="LiuCheng"><meta name="copyright" content="LiuCheng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Redis 详解：从入门到精通一、Redis 到底是什么？一句话定义：Redis（Remote Dictionary Server）是一个超高性能的内存数据库，同时支持数据持久化。 通俗比喻：  传统数据库（MySQL） &#x3D; 图书馆（数据在硬盘，找书慢但容量大） Redis &#x3D; 你的办公桌（数据在内存，随手就拿，但桌子大小有限）   二、Redis 的核心特点1. 内存存储 -">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis分布式锁">
<meta property="og:url" content="https://mr-liu-cheng.github.io/2026/01/28/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/">
<meta property="og:site_name" content="LiuCheng&#39;s Blog">
<meta property="og:description" content="Redis 详解：从入门到精通一、Redis 到底是什么？一句话定义：Redis（Remote Dictionary Server）是一个超高性能的内存数据库，同时支持数据持久化。 通俗比喻：  传统数据库（MySQL） &#x3D; 图书馆（数据在硬盘，找书慢但容量大） Redis &#x3D; 你的办公桌（数据在内存，随手就拿，但桌子大小有限）   二、Redis 的核心特点1. 内存存储 -">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mr-liu-cheng.github.io/img/favicon.png">
<meta property="article:published_time" content="2026-01-28T12:06:02.000Z">
<meta property="article:modified_time" content="2026-01-28T12:06:02.000Z">
<meta property="article:author" content="LiuCheng">
<meta property="article:tag" content="分布式锁">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mr-liu-cheng.github.io/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://mr-liu-cheng.github.io/2026/01/28/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-1389699351715193',
  enable_page_level_ads: 'true'
});</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redis分布式锁',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (true) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">84</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">67</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">49</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa-solid fa-book"></i><span> Doc</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa-solid fa-timeline"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tag</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa-solid fa-folder-tree"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/game/"><i class="fa-fw fa-solid fa-gamepad"></i><span> Game</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/About/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa-regular fa-pen-to-square"></i><span> More</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/musicPage/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/%E5%BD%B1%E8%A7%86%E5%88%86%E4%BA%AB/"><i class="fa-fw fa-solid fa-film"></i><span> Vidio Sharing</span></a></li><li><a class="site-page child" href="/%E7%BE%8E%E9%A3%9F/"><i class="fa-fw fa-solid fa-mug-hot"></i><span> Delicious</span></a></li><li><a class="site-page child" href="/%E6%B8%B8%E8%AE%B0/"><i class="fa-fw fa-solid fa-person-hiking"></i><span> Tourist</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Calendar/"><i class="fa-fw fa-regular fa-calendar-check"></i><span> Calendar</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/favicon.png" alt="Logo"><span class="site-name">LiuCheng's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Redis分布式锁</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa-solid fa-book"></i><span> Doc</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa-solid fa-timeline"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tag</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa-solid fa-folder-tree"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/game/"><i class="fa-fw fa-solid fa-gamepad"></i><span> Game</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/About/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa-regular fa-pen-to-square"></i><span> More</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/musicPage/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/%E5%BD%B1%E8%A7%86%E5%88%86%E4%BA%AB/"><i class="fa-fw fa-solid fa-film"></i><span> Vidio Sharing</span></a></li><li><a class="site-page child" href="/%E7%BE%8E%E9%A3%9F/"><i class="fa-fw fa-solid fa-mug-hot"></i><span> Delicious</span></a></li><li><a class="site-page child" href="/%E6%B8%B8%E8%AE%B0/"><i class="fa-fw fa-solid fa-person-hiking"></i><span> Tourist</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Calendar/"><i class="fa-fw fa-regular fa-calendar-check"></i><span> Calendar</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Redis分布式锁</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-01-28T12:06:02.000Z" title="发表于 2026-01-28 12:06:02">2026-01-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-28T12:06:02.000Z" title="更新于 2026-01-28 12:06:02">2026-01-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">网络编程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="Redis-详解：从入门到精通"><a href="#Redis-详解：从入门到精通" class="headerlink" title="Redis 详解：从入门到精通"></a>Redis 详解：从入门到精通</h1><h2 id="一、Redis-到底是什么？"><a href="#一、Redis-到底是什么？" class="headerlink" title="一、Redis 到底是什么？"></a>一、Redis 到底是什么？</h2><p><strong>一句话定义</strong>：Redis（Remote Dictionary Server）是一个<strong>超高性能的内存数据库</strong>，同时支持数据持久化。</p>
<p><strong>通俗比喻</strong>：</p>
<ul>
<li><strong>传统数据库（MySQL）</strong> &#x3D; 图书馆（数据在硬盘，找书慢但容量大）</li>
<li><strong>Redis</strong> &#x3D; 你的办公桌（数据在内存，随手就拿，但桌子大小有限）</li>
</ul>
<hr>
<h2 id="二、Redis-的核心特点"><a href="#二、Redis-的核心特点" class="headerlink" title="二、Redis 的核心特点"></a>二、Redis 的核心特点</h2><h3 id="1-内存存储-极速读写"><a href="#1-内存存储-极速读写" class="headerlink" title="1. 内存存储 - 极速读写"></a>1. <strong>内存存储 - 极速读写</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对比测试：Redis vs MySQL</span></span><br><span class="line">MySQL读取: <span class="number">5</span>-<span class="number">10</span>毫秒  <span class="comment"># 需要磁盘I/O</span></span><br><span class="line">Redis读取: <span class="number">0.1</span>毫秒    <span class="comment"># 内存直接访问，快50-100倍！</span></span><br></pre></td></tr></table></figure>

<h3 id="2-丰富的数据结构"><a href="#2-丰富的数据结构" class="headerlink" title="2. 丰富的数据结构"></a>2. <strong>丰富的数据结构</strong></h3><p>不只是简单的 key-value，还有：</p>
<ul>
<li>字符串（String）</li>
<li>哈希表（Hash）</li>
<li>列表（List）</li>
<li>集合（Set）</li>
<li>有序集合（Sorted Set）</li>
<li>等等…</li>
</ul>
<h3 id="3-持久化可选"><a href="#3-持久化可选" class="headerlink" title="3. 持久化可选"></a>3. <strong>持久化可选</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内存数据 → 定期保存到磁盘 → 重启后可以恢复</span><br></pre></td></tr></table></figure>

<h3 id="4-单线程架构"><a href="#4-单线程架构" class="headerlink" title="4. 单线程架构"></a>4. <strong>单线程架构</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">一个线程处理所有请求 → 无锁竞争 → 超高并发性能</span><br><span class="line">（实际是多路复用，非多线程）</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三、Redis-解决了什么问题？"><a href="#三、Redis-解决了什么问题？" class="headerlink" title="三、Redis 解决了什么问题？"></a>三、Redis 解决了什么问题？</h2><h3 id="场景1：网站首页加载慢"><a href="#场景1：网站首页加载慢" class="headerlink" title="场景1：网站首页加载慢"></a>场景1：网站首页加载慢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 传统方案：每次访问都要查数据库</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> featured <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 耗时50ms</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">ORDER</span> <span class="keyword">BY</span> create_time <span class="keyword">DESC</span> LIMIT <span class="number">10</span>;  <span class="comment">-- 耗时30ms</span></span><br><span class="line"><span class="comment">-- 总耗时：80ms，QPS=12（每秒处理12个请求）</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis方案：缓存查询结果</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">r = redis.Redis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_homepage_data</span>():</span><br><span class="line">    <span class="comment"># 先查Redis缓存（0.5ms）</span></span><br><span class="line">    cached = r.get(<span class="string">&#x27;homepage:data&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> cached:</span><br><span class="line">        <span class="keyword">return</span> json.loads(cached)  <span class="comment"># 缓存命中，直接返回</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 缓存未命中，查数据库</span></span><br><span class="line">    data = query_database()  <span class="comment"># 耗时80ms</span></span><br><span class="line">    <span class="comment"># 存入缓存，下次直接用</span></span><br><span class="line">    r.setex(<span class="string">&#x27;homepage:data&#x27;</span>, <span class="number">300</span>, json.dumps(data))  <span class="comment"># 缓存5分钟</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"><span class="comment"># 结果：80ms → 0.5ms，性能提升160倍！</span></span><br></pre></td></tr></table></figure>

<h3 id="场景2：秒杀系统崩溃"><a href="#场景2：秒杀系统崩溃" class="headerlink" title="场景2：秒杀系统崩溃"></a>场景2：秒杀系统崩溃</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">传统架构：</span><br><span class="line">10万人同时抢1000件商品 → 所有请求打到数据库 → 数据库连接池耗尽 → 系统崩溃</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Redis架构：</span><br><span class="line">1. 商品库存预加载到Redis：SET seckill:stock:1001 1000</span><br><span class="line">2. 用户请求到达：</span><br><span class="line">   DECR seckill:stock:1001  # Redis原子操作，线程安全</span><br><span class="line">   # 返回结果：999（成功）或 -1（库存不足）</span><br><span class="line">3. 异步同步到数据库</span><br><span class="line">结果：支持10万QPS，系统稳定</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四、Redis-的-7-大核心作用"><a href="#四、Redis-的-7-大核心作用" class="headerlink" title="四、Redis 的 7 大核心作用"></a>四、Redis 的 7 大核心作用</h2><h3 id="1-缓存系统（最主要用途）"><a href="#1-缓存系统（最主要用途）" class="headerlink" title="1. 缓存系统（最主要用途）"></a>1. <strong>缓存系统（最主要用途）</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多级缓存架构</span></span><br><span class="line">┌─────────┐   ┌─────────┐   ┌─────────┐</span><br><span class="line">│ 浏览器  │ → │ CDN缓存 │ → │ Nginx   │</span><br><span class="line">│  缓存   │   │         │   │ 缓存    │</span><br><span class="line">└─────────┘   └─────────┘   └─────────┘</span><br><span class="line">                    ↓</span><br><span class="line">              ┌─────────┐   ┌─────────┐</span><br><span class="line">              │ Redis   │ → │ 数据库  │</span><br><span class="line">              │ 缓存    │   │         │</span><br><span class="line">              └─────────┘   └─────────┘</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存策略示例</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_profile</span>(<span class="params">user_id</span>):</span><br><span class="line">    cache_key = <span class="string">f&quot;user:profile:<span class="subst">&#123;user_id&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 先查Redis</span></span><br><span class="line">    data = redis_client.get(cache_key)</span><br><span class="line">    <span class="keyword">if</span> data:</span><br><span class="line">        <span class="keyword">return</span> json.loads(data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. Redis没有，查数据库</span></span><br><span class="line">    data = db.query(<span class="string">&quot;SELECT * FROM users WHERE id = %s&quot;</span>, user_id)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 写入Redis（设置过期时间，避免缓存雪崩）</span></span><br><span class="line">    redis_client.setex(cache_key, <span class="number">3600</span>, json.dumps(data))  <span class="comment"># 缓存1小时</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<h3 id="2-会话存储（Session-Store）"><a href="#2-会话存储（Session-Store）" class="headerlink" title="2. 会话存储（Session Store）"></a>2. <strong>会话存储（Session Store）</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 传统Session问题：单机存储，负载均衡后丢失</span></span><br><span class="line"><span class="comment"># Redis解决方案：集中式Session存储</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session</span><br><span class="line"><span class="keyword">from</span> flask_session <span class="keyword">import</span> RedisSessionInterface</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SESSION_TYPE&#x27;</span>] = <span class="string">&#x27;redis&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;SESSION_REDIS&#x27;</span>] = redis.Redis(host=<span class="string">&#x27;redis-cluster&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户登录</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    session[<span class="string">&#x27;user_id&#x27;</span>] = <span class="number">123</span></span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;张三&#x27;</span></span><br><span class="line">    <span class="comment"># 实际存储到Redis：SETEX session:abc123 3600 &#123;...&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;登录成功&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 任何服务器都能读取</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/profile&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile</span>():</span><br><span class="line">    user_id = session.get(<span class="string">&#x27;user_id&#x27;</span>)  <span class="comment"># 从Redis读取</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;用户ID: <span class="subst">&#123;user_id&#125;</span>&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-实时排行榜"><a href="#3-实时排行榜" class="headerlink" title="3. 实时排行榜"></a>3. <strong>实时排行榜</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 游戏积分排行榜</span><br><span class="line">ZADD game:leaderboard 5000 &quot;player:001&quot;</span><br><span class="line">ZADD game:leaderboard 4800 &quot;player:002&quot;</span><br><span class="line">ZADD game:leaderboard 5200 &quot;player:003&quot;</span><br><span class="line"></span><br><span class="line"># 获取前10名</span><br><span class="line">ZREVRANGE game:leaderboard 0 9 WITHSCORES</span><br><span class="line"># 结果：</span><br><span class="line"># 1) &quot;player:003&quot;</span><br><span class="line"># 2) &quot;5200&quot;</span><br><span class="line"># 3) &quot;player:001&quot;</span><br><span class="line"># 4) &quot;5000&quot;</span><br><span class="line"></span><br><span class="line"># 获取玩家排名</span><br><span class="line">ZREVRANK game:leaderboard &quot;player:001&quot;  # 返回：1（第二名）</span><br><span class="line"></span><br><span class="line"># 实时更新分数</span><br><span class="line">ZINCRBY game:leaderboard 100 &quot;player:002&quot;  # 增加100分</span><br></pre></td></tr></table></figure>

<h3 id="4-消息队列"><a href="#4-消息队列" class="headerlink" title="4. 消息队列"></a>4. <strong>消息队列</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 简单的发布订阅系统</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">r = redis.Redis()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布者</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">publish_order</span>(<span class="params">order_data</span>):</span><br><span class="line">    r.publish(<span class="string">&#x27;orders&#x27;</span>, json.dumps(order_data))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅者</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">order_processor</span>():</span><br><span class="line">    pubsub = r.pubsub()</span><br><span class="line">    pubsub.subscribe(<span class="string">&#x27;orders&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> message <span class="keyword">in</span> pubsub.listen():</span><br><span class="line">        <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;message&#x27;</span>:</span><br><span class="line">            order = json.loads(message[<span class="string">&#x27;data&#x27;</span>])</span><br><span class="line">            process_order(order)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更专业的队列：使用List</span></span><br><span class="line"><span class="comment"># 生产者</span></span><br><span class="line">r.lpush(<span class="string">&#x27;task:queue&#x27;</span>, <span class="string">&#x27;task_data&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 消费者（阻塞获取）</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    task = r.brpop(<span class="string">&#x27;task:queue&#x27;</span>, timeout=<span class="number">30</span>)  <span class="comment"># 阻塞30秒</span></span><br><span class="line">    <span class="keyword">if</span> task:</span><br><span class="line">        process_task(task[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<h3 id="5-分布式锁"><a href="#5-分布式锁" class="headerlink" title="5. 分布式锁"></a>5. <strong>分布式锁</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RedisDistributedLock</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, redis_client, lock_key, expire_time=<span class="number">30</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.redis = redis_client</span><br><span class="line">        <span class="variable language_">self</span>.lock_key = lock_key</span><br><span class="line">        <span class="variable language_">self</span>.expire_time = expire_time</span><br><span class="line">        <span class="variable language_">self</span>.identifier = <span class="built_in">str</span>(uuid.uuid4())  <span class="comment"># 唯一标识</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">acquire</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># SET key value NX EX timeout  （原子操作）</span></span><br><span class="line">        result = <span class="variable language_">self</span>.redis.<span class="built_in">set</span>(</span><br><span class="line">            <span class="variable language_">self</span>.lock_key,</span><br><span class="line">            <span class="variable language_">self</span>.identifier,</span><br><span class="line">            ex=<span class="variable language_">self</span>.expire_time,</span><br><span class="line">            nx=<span class="literal">True</span>  <span class="comment"># 仅当key不存在时设置</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> result <span class="keyword">is</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">release</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># Lua脚本保证原子性：只有锁的持有者才能释放</span></span><br><span class="line">        script = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then</span></span><br><span class="line"><span class="string">            return redis.call(&#x27;del&#x27;, KEYS[1])</span></span><br><span class="line"><span class="string">        else</span></span><br><span class="line"><span class="string">            return 0</span></span><br><span class="line"><span class="string">        end</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.redis.<span class="built_in">eval</span>(script, <span class="number">1</span>, <span class="variable language_">self</span>.lock_key, <span class="variable language_">self</span>.identifier)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">lock = RedisDistributedLock(redis_client, <span class="string">&#x27;order:create:lock&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> lock.acquire():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 执行需要加锁的操作</span></span><br><span class="line">        create_order()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        lock.release()</span><br></pre></td></tr></table></figure>

<h3 id="6-实时计数器"><a href="#6-实时计数器" class="headerlink" title="6. 实时计数器"></a>6. <strong>实时计数器</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文章阅读量统计</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">increment_read_count</span>(<span class="params">article_id</span>):</span><br><span class="line">    <span class="comment"># 原子操作，线程安全</span></span><br><span class="line">    count = redis_client.incr(<span class="string">f&#x27;article:reads:<span class="subst">&#123;article_id&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 每100次阅读同步到数据库</span></span><br><span class="line">    <span class="keyword">if</span> count % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">        db.execute(</span><br><span class="line">            <span class="string">&quot;UPDATE articles SET read_count = %s WHERE id = %s&quot;</span>,</span><br><span class="line">            count, article_id</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计在线用户数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_online</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="comment"># 用户上线</span></span><br><span class="line">    redis_client.sadd(<span class="string">&#x27;online:users&#x27;</span>, user_id)</span><br><span class="line">    redis_client.setex(<span class="string">f&#x27;user:online:<span class="subst">&#123;user_id&#125;</span>&#x27;</span>, <span class="number">300</span>, <span class="string">&#x27;1&#x27;</span>)  <span class="comment"># 5分钟超时</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计在线人数</span></span><br><span class="line">    online_count = redis_client.scard(<span class="string">&#x27;online:users&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> online_count</span><br></pre></td></tr></table></figure>

<h3 id="7-地理空间索引"><a href="#7-地理空间索引" class="headerlink" title="7. 地理空间索引"></a>7. <strong>地理空间索引</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 存储外卖商家位置</span><br><span class="line">GEOADD delivery:shops 116.397128 39.916527 &quot;shop:001&quot;</span><br><span class="line">GEOADD delivery:shops 116.407526 39.904030 &quot;shop:002&quot;</span><br><span class="line"></span><br><span class="line"># 查找附近3公里内的商家</span><br><span class="line">GEORADIUS delivery:shops 116.400000 39.900000 3 km WITHDIST</span><br><span class="line"># 结果：</span><br><span class="line"># 1) 1) &quot;shop:002&quot;</span><br><span class="line">#    2) &quot;1.2345&quot;  # 距离公里数</span><br><span class="line"># 2) 1) &quot;shop:001&quot;</span><br><span class="line">#    2) &quot;2.5678&quot;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五、Redis-数据结构深度解析"><a href="#五、Redis-数据结构深度解析" class="headerlink" title="五、Redis 数据结构深度解析"></a>五、Redis 数据结构深度解析</h2><h3 id="1-String（字符串）"><a href="#1-String（字符串）" class="headerlink" title="1. String（字符串）"></a>1. <strong>String（字符串）</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 不仅仅是字符串，还能存数字、二进制数据</span><br><span class="line">SET user:1001:name &quot;张三&quot;</span><br><span class="line">SET user:1001:age 25</span><br><span class="line">INCR user:1001:age  # 原子递增 → 26</span><br><span class="line"></span><br><span class="line"># 位图（Bitmap）应用：用户签到</span><br><span class="line">SETBIT sign:2024:01 1001 1  # 用户1001在1月1日签到</span><br><span class="line">SETBIT sign:2024:01 1002 1</span><br><span class="line">BITCOUNT sign:2024:01  # 统计1月1日签到人数：2</span><br></pre></td></tr></table></figure>

<h3 id="2-Hash（哈希表）"><a href="#2-Hash（哈希表）" class="headerlink" title="2. Hash（哈希表）"></a>2. <strong>Hash（哈希表）</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 存储对象</span><br><span class="line">HSET user:1001 name &quot;张三&quot; age 25 city &quot;北京&quot;</span><br><span class="line">HGET user:1001 name  # &quot;张三&quot;</span><br><span class="line">HGETALL user:1001    # 获取所有字段</span><br><span class="line">HINCRBY user:1001 age 1  # 年龄+1</span><br><span class="line"></span><br><span class="line"># 对比：String vs Hash</span><br><span class="line"># String方案：SET user:1001 &#x27;&#123;&quot;name&quot;:&quot;张三&quot;,&quot;age&quot;:25&#125;&#x27;（修改需要读取整个对象）</span><br><span class="line"># Hash方案：HSET user:1001 age 26（只修改age字段，更高效）</span><br></pre></td></tr></table></figure>

<h3 id="3-List（列表）"><a href="#3-List（列表）" class="headerlink" title="3. List（列表）"></a>3. <strong>List（列表）</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 实现消息队列、最新列表</span><br><span class="line">LPUSH news:latest &quot;新闻A&quot;  # 左边插入</span><br><span class="line">LPUSH news:latest &quot;新闻B&quot;</span><br><span class="line">LRANGE news:latest 0 9  # 获取最新10条新闻</span><br><span class="line"></span><br><span class="line"># 实现栈或队列</span><br><span class="line">LPUSH task:queue &quot;task1&quot;  # 生产者</span><br><span class="line">RPOP task:queue  # 消费者（队列）</span><br><span class="line"># 或</span><br><span class="line">LPOP task:queue  # 栈</span><br></pre></td></tr></table></figure>

<h3 id="4-Set（集合）"><a href="#4-Set（集合）" class="headerlink" title="4. Set（集合）"></a>4. <strong>Set（集合）</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 去重集合</span><br><span class="line">SADD user:1001:follows 2001 2002 2003  # 关注列表</span><br><span class="line">SADD user:1002:follows 2001 2003 2004</span><br><span class="line"></span><br><span class="line"># 共同关注（交集）</span><br><span class="line">SINTER user:1001:follows user:1002:follows</span><br><span class="line"># 结果：2001, 2003</span><br><span class="line"></span><br><span class="line"># 可能认识的人（差集）</span><br><span class="line">SDIFF user:1002:follows user:1001:follows</span><br><span class="line"># 结果：2004</span><br></pre></td></tr></table></figure>

<h3 id="5-Sorted-Set（有序集合）"><a href="#5-Sorted-Set（有序集合）" class="headerlink" title="5. Sorted Set（有序集合）"></a>5. <strong>Sorted Set（有序集合）</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 带权重的集合，自动排序</span><br><span class="line">ZADD leaderboard 95 &quot;Alice&quot;</span><br><span class="line">ZADD leaderboard 87 &quot;Bob&quot;</span><br><span class="line">ZADD leaderboard 92 &quot;Charlie&quot;</span><br><span class="line"></span><br><span class="line"># 获取排名</span><br><span class="line">ZREVRANGE leaderboard 0 2 WITHSCORES</span><br><span class="line"># 1) &quot;Alice&quot;  2) &quot;95&quot;</span><br><span class="line"># 3) &quot;Charlie&quot; 4) &quot;92&quot;</span><br><span class="line"># 5) &quot;Bob&quot;    6) &quot;87&quot;</span><br><span class="line"></span><br><span class="line"># 范围查询：分数80-90的玩家</span><br><span class="line">ZRANGEBYSCORE leaderboard 80 90</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="六、Redis-架构模式"><a href="#六、Redis-架构模式" class="headerlink" title="六、Redis 架构模式"></a>六、Redis 架构模式</h2><h3 id="1-单机模式"><a href="#1-单机模式" class="headerlink" title="1. 单机模式"></a>1. <strong>单机模式</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最简单的部署方式</span></span><br><span class="line">redis-server redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 适用场景：开发测试、小流量应用</span></span><br><span class="line"><span class="comment"># 优点：简单、无网络开销</span></span><br><span class="line"><span class="comment"># 缺点：单点故障、容量有限</span></span><br></pre></td></tr></table></figure>

<h3 id="2-主从复制"><a href="#2-主从复制" class="headerlink" title="2. 主从复制"></a>2. <strong>主从复制</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主节点（可读写） → 复制 → 从节点（只读）</span><br><span class="line">       ↓                     ↓</span><br><span class="line">   写操作                  读操作分流</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从节点配置</span></span><br><span class="line">slaveof 192.168.1.100 6379</span><br><span class="line"><span class="comment"># 优点：读写分离、数据备份</span></span><br><span class="line"><span class="comment"># 缺点：主节点单点故障</span></span><br></pre></td></tr></table></figure>

<h3 id="3-哨兵模式（Sentinel）"><a href="#3-哨兵模式（Sentinel）" class="headerlink" title="3. 哨兵模式（Sentinel）"></a>3. <strong>哨兵模式（Sentinel）</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">┌─────────┐     ┌─────────┐     ┌─────────┐</span><br><span class="line">│ Sentinel│     │ Sentinel│     │ Sentinel│</span><br><span class="line">│   集群  │     │   集群  │     │   集群  │</span><br><span class="line">└────┬────┘     └────┬────┘     └────┬────┘</span><br><span class="line">     │监控和自动故障转移│</span><br><span class="line">┌────▼───────────────▼───────────────▼────┐</span><br><span class="line">│        Redis主从集群                   │</span><br><span class="line">│   ┌─────┐          ┌─────┐          │</span><br><span class="line">│   │Master│──复制──▶│Slave1│          │</span><br><span class="line">│   └─────┘          └─────┘          │</span><br><span class="line">│          ▲         ┌─────┐          │</span><br><span class="line">│          └──复制──▶│Slave2│          │</span><br><span class="line">│                   └─────┘          │</span><br><span class="line">└─────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h3 id="4-集群模式（Cluster）"><a href="#4-集群模式（Cluster）" class="headerlink" title="4. 集群模式（Cluster）"></a>4. <strong>集群模式（Cluster）</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis集群：16384个槽位分散到多个节点</span></span><br><span class="line"><span class="comment"># 自动分片、高可用</span></span><br><span class="line">redis-cli --cluster create \</span><br><span class="line">  192.168.1.101:6379 \</span><br><span class="line">  192.168.1.102:6379 \</span><br><span class="line">  192.168.1.103:6379 \</span><br><span class="line">  --cluster-replicas 1  <span class="comment"># 每个主节点一个从节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据分布示例：</span></span><br><span class="line"><span class="comment"># 节点1：槽位 0-5460</span></span><br><span class="line"><span class="comment"># 节点2：槽位 5461-10922  </span></span><br><span class="line"><span class="comment"># 节点3：槽位 10923-16383</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="七、Redis-实战场景"><a href="#七、Redis-实战场景" class="headerlink" title="七、Redis 实战场景"></a>七、Redis 实战场景</h2><h3 id="场景1：电商商品详情页"><a href="#场景1：电商商品详情页" class="headerlink" title="场景1：电商商品详情页"></a>场景1：电商商品详情页</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ProductDetailCache</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.redis = redis.Redis()</span><br><span class="line">        <span class="variable language_">self</span>.db = Database()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_product_detail</span>(<span class="params">self, product_id</span>):</span><br><span class="line">        <span class="comment"># 缓存键设计</span></span><br><span class="line">        cache_key = <span class="string">f&quot;product:detail:<span class="subst">&#123;product_id&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 查缓存</span></span><br><span class="line">        data = <span class="variable language_">self</span>.redis.get(cache_key)</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            <span class="keyword">return</span> json.loads(data)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 缓存未命中，构建缓存数据</span></span><br><span class="line">        product = <span class="variable language_">self</span>.db.get_product(product_id)</span><br><span class="line">        skus = <span class="variable language_">self</span>.db.get_product_skus(product_id)</span><br><span class="line">        comments = <span class="variable language_">self</span>.db.get_product_comments(product_id)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 组装数据</span></span><br><span class="line">        detail_data = &#123;</span><br><span class="line">            <span class="string">&#x27;product&#x27;</span>: product,</span><br><span class="line">            <span class="string">&#x27;skus&#x27;</span>: skus,</span><br><span class="line">            <span class="string">&#x27;comments&#x27;</span>: comments</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. 异步写入缓存（防止缓存雪崩）</span></span><br><span class="line">        <span class="comment"># 过期时间添加随机值</span></span><br><span class="line">        expire_time = <span class="number">300</span> + random.randint(<span class="number">0</span>, <span class="number">60</span>)  <span class="comment"># 300-360秒</span></span><br><span class="line">        <span class="variable language_">self</span>.redis.setex(cache_key, expire_time, json.dumps(detail_data))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> detail_data</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_product_cache</span>(<span class="params">self, product_id</span>):</span><br><span class="line">        <span class="comment"># 商品更新时，删除缓存（缓存失效）</span></span><br><span class="line">        cache_key = <span class="string">f&quot;product:detail:<span class="subst">&#123;product_id&#125;</span>&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.redis.delete(cache_key)</span><br><span class="line">        <span class="comment"># 或更新缓存</span></span><br><span class="line">        <span class="comment"># self.redis.setex(cache_key, 300, new_data)</span></span><br></pre></td></tr></table></figure>

<h3 id="场景2：秒杀系统设计"><a href="#场景2：秒杀系统设计" class="headerlink" title="场景2：秒杀系统设计"></a>场景2：秒杀系统设计</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SeckillSystem</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.redis = redis.Redis()</span><br><span class="line">        <span class="variable language_">self</span>.mq = MessageQueue()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init_seckill</span>(<span class="params">self, seckill_id, stock</span>):</span><br><span class="line">        <span class="comment"># 初始化秒杀库存</span></span><br><span class="line">        stock_key = <span class="string">f&quot;seckill:stock:<span class="subst">&#123;seckill_id&#125;</span>&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.redis.<span class="built_in">set</span>(stock_key, stock)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 用户去重集合（防止重复购买）</span></span><br><span class="line">        <span class="variable language_">self</span>.redis.delete(<span class="string">f&quot;seckill:users:<span class="subst">&#123;seckill_id&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">seckill_request</span>(<span class="params">self, user_id, seckill_id</span>):</span><br><span class="line">        <span class="comment"># 1. 频率限制：1秒内只能请求1次</span></span><br><span class="line">        rate_key = <span class="string">f&quot;seckill:rate:<span class="subst">&#123;user_id&#125;</span>:<span class="subst">&#123;seckill_id&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.redis.exists(rate_key):</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;code&quot;</span>: <span class="number">429</span>, <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;请求太频繁&quot;</span>&#125;</span><br><span class="line">        <span class="variable language_">self</span>.redis.setex(rate_key, <span class="number">1</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 用户去重检查</span></span><br><span class="line">        users_key = <span class="string">f&quot;seckill:users:<span class="subst">&#123;seckill_id&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.redis.sismember(users_key, user_id):</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;code&quot;</span>: <span class="number">400</span>, <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;已经参与过&quot;</span>&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. 扣减库存（原子操作）</span></span><br><span class="line">        stock_key = <span class="string">f&quot;seckill:stock:<span class="subst">&#123;seckill_id&#125;</span>&quot;</span></span><br><span class="line">        remaining = <span class="variable language_">self</span>.redis.decr(stock_key)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> remaining &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 库存不足，恢复库存</span></span><br><span class="line">            <span class="variable language_">self</span>.redis.incr(stock_key)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;code&quot;</span>: <span class="number">400</span>, <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;库存不足&quot;</span>&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. 记录用户购买</span></span><br><span class="line">        <span class="variable language_">self</span>.redis.sadd(users_key, user_id)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 5. 发送MQ消息，异步创建订单</span></span><br><span class="line">        order_data = &#123;</span><br><span class="line">            <span class="string">&quot;user_id&quot;</span>: user_id,</span><br><span class="line">            <span class="string">&quot;seckill_id&quot;</span>: seckill_id,</span><br><span class="line">            <span class="string">&quot;time&quot;</span>: time.time()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.mq.send(<span class="string">&quot;seckill_orders&quot;</span>, order_data)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;code&quot;</span>: <span class="number">200</span>, <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;秒杀成功&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="场景3：实时在线人数统计"><a href="#场景3：实时在线人数统计" class="headerlink" title="场景3：实时在线人数统计"></a>场景3：实时在线人数统计</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OnlineUserTracker</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.redis = redis.Redis()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_online</span>(<span class="params">self, user_id</span>):</span><br><span class="line">        <span class="comment"># 用户上线</span></span><br><span class="line">        now = <span class="built_in">int</span>(time.time())</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 方法1：使用Sorted Set记录用户最后活跃时间</span></span><br><span class="line">        <span class="variable language_">self</span>.redis.zadd(<span class="string">&#x27;online:users&#x27;</span>, &#123;user_id: now&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 方法2：使用Hash记录详细信息</span></span><br><span class="line">        user_key = <span class="string">f&#x27;user:online:<span class="subst">&#123;user_id&#125;</span>&#x27;</span></span><br><span class="line">        <span class="variable language_">self</span>.redis.hset(user_key, <span class="string">&#x27;last_seen&#x27;</span>, now)</span><br><span class="line">        <span class="variable language_">self</span>.redis.hset(user_key, <span class="string">&#x27;ip&#x27;</span>, request_ip)</span><br><span class="line">        <span class="variable language_">self</span>.redis.expire(user_key, <span class="number">3600</span>)  <span class="comment"># 1小时过期</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_online_count</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 获取5分钟内在线的用户数</span></span><br><span class="line">        five_min_ago = <span class="built_in">int</span>(time.time()) - <span class="number">300</span></span><br><span class="line">        count = <span class="variable language_">self</span>.redis.zcount(<span class="string">&#x27;online:users&#x27;</span>, five_min_ago, <span class="string">&#x27;+inf&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_online_users</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 获取在线用户列表</span></span><br><span class="line">        five_min_ago = <span class="built_in">int</span>(time.time()) - <span class="number">300</span></span><br><span class="line">        users = <span class="variable language_">self</span>.redis.zrangebyscore(<span class="string">&#x27;online:users&#x27;</span>, five_min_ago, <span class="string">&#x27;+inf&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> users</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cleanup_offline_users</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 清理24小时未活动的用户</span></span><br><span class="line">        one_day_ago = <span class="built_in">int</span>(time.time()) - <span class="number">86400</span></span><br><span class="line">        <span class="variable language_">self</span>.redis.zremrangebyscore(<span class="string">&#x27;online:users&#x27;</span>, <span class="string">&#x27;-inf&#x27;</span>, one_day_ago)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="八、Redis-常见问题与解决方案"><a href="#八、Redis-常见问题与解决方案" class="headerlink" title="八、Redis 常见问题与解决方案"></a>八、Redis 常见问题与解决方案</h2><h3 id="1-缓存穿透"><a href="#1-缓存穿透" class="headerlink" title="1. 缓存穿透"></a>1. <strong>缓存穿透</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">问题：查询不存在的数据 → 缓存不命中 → 一直查数据库</span><br><span class="line">示例：恶意请求查询 user:999999（不存在）</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">user_id</span>):</span><br><span class="line">    cache_key = <span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 布隆过滤器预先检查</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bloom_filter.exists(user_id):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 缓存空值</span></span><br><span class="line">    data = redis.get(cache_key)</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> data == <span class="string">&quot;&quot;</span>:  <span class="comment"># 空值标记</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> json.loads(data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 查数据库</span></span><br><span class="line">    user = db.query(<span class="string">&quot;SELECT * FROM users WHERE id = %s&quot;</span>, user_id)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> user:</span><br><span class="line">        redis.setex(cache_key, <span class="number">300</span>, json.dumps(user))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 缓存空值，避免下次再查数据库</span></span><br><span class="line">        redis.setex(cache_key, <span class="number">60</span>, <span class="string">&quot;&quot;</span>)  <span class="comment"># 较短过期时间</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> user</span><br></pre></td></tr></table></figure>

<h3 id="2-缓存雪崩"><a href="#2-缓存雪崩" class="headerlink" title="2. 缓存雪崩"></a>2. <strong>缓存雪崩</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">问题：大量缓存同时过期 → 所有请求打到数据库 → 数据库崩溃</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 设置不同的过期时间</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_cache_with_random_ttl</span>(<span class="params">key, value, base_ttl=<span class="number">300</span></span>):</span><br><span class="line">    random_ttl = base_ttl + random.randint(-<span class="number">60</span>, <span class="number">60</span>)</span><br><span class="line">    redis.setex(key, random_ttl, value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 热点数据永不过期，后台刷新</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">refresh_hot_cache</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = get_data_from_db()</span><br><span class="line">        redis.<span class="built_in">set</span>(<span class="string">&#x27;hot:data&#x27;</span>, json.dumps(data))</span><br><span class="line">        time.sleep(<span class="number">60</span>)  <span class="comment"># 每分钟刷新一次</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 加锁，防止大量并发重建缓存</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data_with_lock</span>(<span class="params">key</span>):</span><br><span class="line">    data = redis.get(key)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        lock_key = <span class="string">f&quot;lock:<span class="subst">&#123;key&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> redis.setnx(lock_key, <span class="string">&quot;1&quot;</span>):  <span class="comment"># 获取锁</span></span><br><span class="line">            redis.expire(lock_key, <span class="number">10</span>)</span><br><span class="line">            data = get_data_from_db()</span><br><span class="line">            redis.setex(key, <span class="number">300</span>, data)</span><br><span class="line">            redis.delete(lock_key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 等待其他线程重建缓存</span></span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="keyword">return</span> get_data_with_lock(key)  <span class="comment"># 重试</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<h3 id="3-缓存击穿"><a href="#3-缓存击穿" class="headerlink" title="3. 缓存击穿"></a>3. <strong>缓存击穿</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">问题：热点key过期 → 大量并发请求同时重建缓存 → 数据库压力剧增</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_hot_data</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="comment"># 1. 使用互斥锁</span></span><br><span class="line">    lock_key = <span class="string">f&quot;<span class="subst">&#123;key&#125;</span>:lock&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = redis.get(key)</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 尝试获取锁</span></span><br><span class="line">        <span class="keyword">if</span> redis.setnx(lock_key, <span class="string">&quot;1&quot;</span>):</span><br><span class="line">            redis.expire(lock_key, <span class="number">10</span>)  <span class="comment"># 锁10秒超时</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 重建缓存</span></span><br><span class="line">                data = query_database()</span><br><span class="line">                redis.setex(key, <span class="number">300</span>, data)</span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                redis.delete(lock_key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 等待并重试</span></span><br><span class="line">            time.sleep(<span class="number">0.01</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="九、Redis-学习路径"><a href="#九、Redis-学习路径" class="headerlink" title="九、Redis 学习路径"></a>九、Redis 学习路径</h2><h3 id="初学者（1-2周）"><a href="#初学者（1-2周）" class="headerlink" title="初学者（1-2周）"></a>初学者（1-2周）</h3><ol>
<li><strong>基础概念</strong>：数据类型、基本命令</li>
<li><strong>单机部署</strong>：安装、配置、基础操作</li>
<li><strong>客户端使用</strong>：redis-cli、Python&#x2F;Java客户端</li>
<li><strong>实战</strong>：实现简单缓存</li>
</ol>
<h3 id="进阶（1-2个月）"><a href="#进阶（1-2个月）" class="headerlink" title="进阶（1-2个月）"></a>进阶（1-2个月）</h3><ol>
<li><strong>高级特性</strong>：事务、Lua脚本、管道</li>
<li><strong>持久化</strong>：RDB、AOF原理与配置</li>
<li><strong>主从复制</strong>：配置与原理</li>
<li><strong>实战</strong>：会话管理、排行榜、计数器</li>
</ol>
<h3 id="高级（3-6个月）"><a href="#高级（3-6个月）" class="headerlink" title="高级（3-6个月）"></a>高级（3-6个月）</h3><ol>
<li><strong>集群架构</strong>：哨兵、Cluster模式</li>
<li><strong>性能优化</strong>：内存优化、持久化调优</li>
<li><strong>高可用设计</strong>：故障转移、数据备份</li>
<li><strong>实战</strong>：设计秒杀系统、消息队列</li>
</ol>
<h3 id="专家级（6个月以上）"><a href="#专家级（6个月以上）" class="headerlink" title="专家级（6个月以上）"></a>专家级（6个月以上）</h3><ol>
<li><strong>源码阅读</strong>：理解Redis内部实现</li>
<li><strong>定制开发</strong>：开发Redis模块</li>
<li><strong>大规模运维</strong>：监控、告警、调优</li>
<li><strong>多语言客户端开发</strong>：了解协议实现</li>
</ol>
<hr>
<h2 id="十、Redis-适用与不适用场景"><a href="#十、Redis-适用与不适用场景" class="headerlink" title="十、Redis 适用与不适用场景"></a>十、Redis 适用与不适用场景</h2><h3 id="✅-适合使用-Redis-的场景："><a href="#✅-适合使用-Redis-的场景：" class="headerlink" title="✅ 适合使用 Redis 的场景："></a>✅ <strong>适合使用 Redis 的场景</strong>：</h3><ol>
<li><strong>缓存系统</strong>：热点数据、会话缓存</li>
<li><strong>实时统计</strong>：计数器、排行榜、在线人数</li>
<li><strong>消息系统</strong>：简单消息队列、发布订阅</li>
<li><strong>分布式锁</strong>：跨进程&#x2F;服务同步</li>
<li><strong>去重系统</strong>：UV统计、用户签到</li>
<li><strong>地理信息</strong>：附近的人、地点搜索</li>
</ol>
<h3 id="❌-不适合-Redis-的场景："><a href="#❌-不适合-Redis-的场景：" class="headerlink" title="❌ 不适合 Redis 的场景："></a>❌ <strong>不适合 Redis 的场景</strong>：</h3><ol>
<li><strong>海量数据存储</strong>：数据量远超内存容量</li>
<li><strong>复杂查询</strong>：需要多表关联、复杂条件查询</li>
<li><strong>强一致性要求</strong>：Redis主从异步复制</li>
<li><strong>大数据分析</strong>：不适合批量数据分析</li>
<li><strong>持久化为主</strong>：数据安全要求极高，应以数据库为主</li>
</ol>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>Redis 的核心价值</strong>：</p>
<ul>
<li>⚡ <strong>性能</strong>：内存操作，微秒级响应</li>
<li>🎯 <strong>多样性</strong>：丰富数据结构，解决各种问题</li>
<li>🔧 <strong>灵活性</strong>：缓存、队列、锁、统计等一应俱全</li>
<li>📈 <strong>可扩展性</strong>：集群模式支持水平扩展</li>
</ul>
<p><strong>现代架构中的定位</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐</span><br><span class="line">│    应用层        │    │    缓存层        │    │    存储层        │</span><br><span class="line">│   (业务逻辑)    │───▶│   (Redis)       │───▶│   (MySQL/等)   │</span><br><span class="line">│                 │    │ 快速响应         │    │ 持久化存储       │</span><br><span class="line">└─────────────────┘    └─────────────────┘    └─────────────────┘</span><br></pre></td></tr></table></figure>

<p><strong>一句话记忆</strong>：Redis 是<strong>内存中的数据结构服务器</strong>，用<strong>空间换时间</strong>，让应用飞起来！</p>
<hr>
<h1 id="现代服务器架构数据存储全景图"><a href="#现代服务器架构数据存储全景图" class="headerlink" title="现代服务器架构数据存储全景图"></a>现代服务器架构数据存储全景图</h1><p>Redis虽然是性能利器，但在实际生产环境中，需要多种数据存储系统协同工作，才能构建健壮的应用架构。以下是完整的服务器数据存储体系：</p>
<h2 id="一、数据存储的“四层金字塔模型”"><a href="#一、数据存储的“四层金字塔模型”" class="headerlink" title="一、数据存储的“四层金字塔模型”"></a>一、数据存储的“四层金字塔模型”</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────────┐ ← 最快</span><br><span class="line">│    第1层：内存数据层（Redis/Memcached）    │</span><br><span class="line">│    作用：热点数据、会话、计数器           │</span><br><span class="line">│    延迟：微秒级                          │</span><br><span class="line">├─────────────────────────────────────────┤</span><br><span class="line">│    第2层：磁盘缓存层（本地SSD/PageCache） │</span><br><span class="line">│    作用：文件缓存、临时数据              │</span><br><span class="line">│    延迟：毫秒级                          │</span><br><span class="line">├─────────────────────────────────────────┤</span><br><span class="line">│    第3层：OLTP数据库层（MySQL/PostgreSQL）│</span><br><span class="line">│    作用：业务核心数据、事务              │</span><br><span class="line">│    延迟：几毫秒到几十毫秒                │</span><br><span class="line">├─────────────────────────────────────────┤</span><br><span class="line">│    第4层：大数据/归档层（HDFS/对象存储）  │</span><br><span class="line">│    作用：历史数据、日志、备份            │</span><br><span class="line">│    延迟：秒级到分钟级                    │</span><br><span class="line">└─────────────────────────────────────────┘ ← 最慢</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mr-liu-cheng.github.io">LiuCheng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mr-liu-cheng.github.io/2026/01/28/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/">https://mr-liu-cheng.github.io/2026/01/28/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://mr-liu-cheng.github.io" target="_blank">LiuCheng's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/">分布式锁</a><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><div class="post-share"><div class="social-share" data-image="/img/favicon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxpay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wxpay.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/01/22/K8s/" title="K8s"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">K8s</div></div><div class="info-2"><div class="info-item-1">棋牌捕鱼类游戏工作项目中用到</div></div></div></a><a class="pagination-related" href="/2026/01/29/%E7%BD%91%E7%BB%9C%E6%B8%B8%E6%88%8F%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/" title="网络游戏分布式架构"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">网络游戏分布式架构</div></div><div class="info-2"><div class="info-item-1">简易网络游戏分布式架构图一、核心架构图（概览）123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778┌─────────────────────────────────────────────────────────────────────────────┐│                            客户端层 (Client Layer)                           │├─────────────────────────────────────────────────────────────────────────────┤│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐           ││  │  手游   │ ...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">LiuCheng</div><div class="author-info-description">不积跬步无以至千里</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">84</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">67</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">49</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Mr-liu-cheng"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://mr-liu-cheng.github.io/img/weixin.jpg" target="_blank" title="WeChat"><i class="fa-brands fa-weixin" style="color: #00ff00;"></i></a><a class="social-icon" href="mailto:liuchengyg@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://mr-liu-cheng.github.io/img/qq.jpg" target="_blank" title="QQ"><i class="fa-brands fa-qq" style="color: #ffffff;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Stay hungry, stay foolish.</div></div><div class="card-widget study-widget" id="study-list"><div class="item-headline"><i class="fas fa-tasks"></i><span>学习目标</span></div><div class="item-content"><div>
  <ul>
    <li>Shader</li>
    <li>华佗热更新</li>
    <li>微信游戏发布</li>
    <li>Steam游戏发布</li>
    <li>广告SDK接入</li>
  </ul>
</div>
</div></div><div class="card-widget calendar-widget" id="calendar-list"><div class="item-headline"><i class="fas fa-tasks"></i><span>今日事今日毕</span></div><div class="item-content"><head>
    <meta charset="UTF-8">
    <title>FullCalendar 农历和调休示例</title>
    <script src='https://cdn.jsdelivr.net/npm/rrule@2.6.4/dist/es5/rrule.min.js'></script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@latest/main.min.css" rel="stylesheet" />
</head>

<body>
    <a href="/Calendar/">
        <!-- 日历容器 -->
        <div id="calendar_aside"></div>
        <!-- FullCalendar JavaScript -->
        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@latest/main.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
        <!-- 引入农历库 -->
        <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@latest/lunar.min.js"></script>
        <!-- 本地脚本加载路径需要添加根目录节点-->
        <script src="/js/myCalendar.js"></script>
        <script>
            Show("calendar_aside");
        </script>
    </a>
</body>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A"><span class="toc-number">1.</span> <span class="toc-text">Redis 详解：从入门到精通</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Redis-%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">一、Redis 到底是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Redis-%E7%9A%84%E6%A0%B8%E5%BF%83%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">二、Redis 的核心特点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%86%85%E5%AD%98%E5%AD%98%E5%82%A8-%E6%9E%81%E9%80%9F%E8%AF%BB%E5%86%99"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. 内存存储 - 极速读写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%B0%E5%AF%8C%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. 丰富的数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%8C%81%E4%B9%85%E5%8C%96%E5%8F%AF%E9%80%89"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. 持久化可选</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.4.</span> <span class="toc-text">4. 单线程架构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Redis-%E8%A7%A3%E5%86%B3%E4%BA%86%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">1.3.</span> <span class="toc-text">三、Redis 解决了什么问题？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E7%BD%91%E7%AB%99%E9%A6%96%E9%A1%B5%E5%8A%A0%E8%BD%BD%E6%85%A2"><span class="toc-number">1.3.1.</span> <span class="toc-text">场景1：网站首页加载慢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E5%B4%A9%E6%BA%83"><span class="toc-number">1.3.2.</span> <span class="toc-text">场景2：秒杀系统崩溃</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Redis-%E7%9A%84-7-%E5%A4%A7%E6%A0%B8%E5%BF%83%E4%BD%9C%E7%94%A8"><span class="toc-number">1.4.</span> <span class="toc-text">四、Redis 的 7 大核心作用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BC%93%E5%AD%98%E7%B3%BB%E7%BB%9F%EF%BC%88%E6%9C%80%E4%B8%BB%E8%A6%81%E7%94%A8%E9%80%94%EF%BC%89"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. 缓存系统（最主要用途）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BC%9A%E8%AF%9D%E5%AD%98%E5%82%A8%EF%BC%88Session-Store%EF%BC%89"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. 会话存储（Session Store）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%9E%E6%97%B6%E6%8E%92%E8%A1%8C%E6%A6%9C"><span class="toc-number">1.4.3.</span> <span class="toc-text">3. 实时排行榜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">1.4.4.</span> <span class="toc-text">4. 消息队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">1.4.5.</span> <span class="toc-text">5. 分布式锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%AE%9E%E6%97%B6%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">1.4.6.</span> <span class="toc-text">6. 实时计数器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%9C%B0%E7%90%86%E7%A9%BA%E9%97%B4%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.7.</span> <span class="toc-text">7. 地理空间索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="toc-number">1.5.</span> <span class="toc-text">五、Redis 数据结构深度解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-String%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. String（字符串）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Hash%EF%BC%88%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%89"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. Hash（哈希表）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><span class="toc-number">1.5.3.</span> <span class="toc-text">3. List（列表）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">1.5.4.</span> <span class="toc-text">4. Set（集合）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Sorted-Set%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">1.5.5.</span> <span class="toc-text">5. Sorted Set（有序集合）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Redis-%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.6.</span> <span class="toc-text">六、Redis 架构模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8D%95%E6%9C%BA%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.6.1.</span> <span class="toc-text">1. 单机模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">1.6.2.</span> <span class="toc-text">2. 主从复制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%EF%BC%88Sentinel%EF%BC%89"><span class="toc-number">1.6.3.</span> <span class="toc-text">3. 哨兵模式（Sentinel）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%EF%BC%88Cluster%EF%BC%89"><span class="toc-number">1.6.4.</span> <span class="toc-text">4. 集群模式（Cluster）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Redis-%E5%AE%9E%E6%88%98%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.</span> <span class="toc-text">七、Redis 实战场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E7%94%B5%E5%95%86%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5"><span class="toc-number">1.7.1.</span> <span class="toc-text">场景1：电商商品详情页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.7.2.</span> <span class="toc-text">场景2：秒杀系统设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF3%EF%BC%9A%E5%AE%9E%E6%97%B6%E5%9C%A8%E7%BA%BF%E4%BA%BA%E6%95%B0%E7%BB%9F%E8%AE%A1"><span class="toc-number">1.7.3.</span> <span class="toc-text">场景3：实时在线人数统计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81Redis-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.8.</span> <span class="toc-text">八、Redis 常见问题与解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="toc-number">1.8.1.</span> <span class="toc-text">1. 缓存穿透</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-number">1.8.2.</span> <span class="toc-text">2. 缓存雪崩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="toc-number">1.8.3.</span> <span class="toc-text">3. 缓存击穿</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81Redis-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84"><span class="toc-number">1.9.</span> <span class="toc-text">九、Redis 学习路径</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%AD%A6%E8%80%85%EF%BC%881-2%E5%91%A8%EF%BC%89"><span class="toc-number">1.9.1.</span> <span class="toc-text">初学者（1-2周）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%EF%BC%881-2%E4%B8%AA%E6%9C%88%EF%BC%89"><span class="toc-number">1.9.2.</span> <span class="toc-text">进阶（1-2个月）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%EF%BC%883-6%E4%B8%AA%E6%9C%88%EF%BC%89"><span class="toc-number">1.9.3.</span> <span class="toc-text">高级（3-6个月）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%93%E5%AE%B6%E7%BA%A7%EF%BC%886%E4%B8%AA%E6%9C%88%E4%BB%A5%E4%B8%8A%EF%BC%89"><span class="toc-number">1.9.4.</span> <span class="toc-text">专家级（6个月以上）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81Redis-%E9%80%82%E7%94%A8%E4%B8%8E%E4%B8%8D%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.10.</span> <span class="toc-text">十、Redis 适用与不适用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E9%80%82%E5%90%88%E4%BD%BF%E7%94%A8-Redis-%E7%9A%84%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-number">1.10.1.</span> <span class="toc-text">✅ 适合使用 Redis 的场景：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E4%B8%8D%E9%80%82%E5%90%88-Redis-%E7%9A%84%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-number">1.10.2.</span> <span class="toc-text">❌ 不适合 Redis 的场景：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.11.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%B0%E4%BB%A3%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%B6%E6%9E%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%85%A8%E6%99%AF%E5%9B%BE"><span class="toc-number">2.</span> <span class="toc-text">现代服务器架构数据存储全景图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%9A%84%E2%80%9C%E5%9B%9B%E5%B1%82%E9%87%91%E5%AD%97%E5%A1%94%E6%A8%A1%E5%9E%8B%E2%80%9D"><span class="toc-number">2.1.</span> <span class="toc-text">一、数据存储的“四层金字塔模型”</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/02/%E6%B8%B8%E6%88%8F%E5%90%8E%E5%8F%B0%E5%BC%80%E5%8F%91/" title="游戏后台开发">游戏后台开发</a><time datetime="2026-02-02T10:28:46.000Z" title="发表于 2026-02-02 10:28:46">2026-02-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/30/CDN/" title="CDN">CDN</a><time datetime="2026-01-30T10:28:46.000Z" title="发表于 2026-01-30 10:28:46">2026-01-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/30/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87/" title="分布式游戏服务器架构开发准备">分布式游戏服务器架构开发准备</a><time datetime="2026-01-30T10:28:46.000Z" title="发表于 2026-01-30 10:28:46">2026-01-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/30/%E6%B8%B8%E6%88%8F%E5%90%8E%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/" title="游戏后端微服务拆分">游戏后端微服务拆分</a><time datetime="2026-01-30T10:28:46.000Z" title="发表于 2026-01-30 10:28:46">2026-01-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/30/%E6%B8%B8%E6%88%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8EDocker%E5%8C%96%E5%AE%9E%E8%B7%B5/" title="游戏微服务的部署与Docker化实践">游戏微服务的部署与Docker化实践</a><time datetime="2026-01-30T10:28:46.000Z" title="发表于 2026-01-30 10:28:46">2026-01-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2026 By LiuCheng</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="music-button" type="button" title="music"><i class="fas fa-music"> </i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = {"language":"zh-CN","distractionFreeMode":true}

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: 'Ov23lisuIzc4KST5xLzO',
      clientSecret: '55972644d3071dd4c51a2e71064e336d2f51aa66',
      repo: 'mr-liu-cheng.github.io',
      owner: 'Mr-liu-cheng',
      admin: ['Mr-liu-cheng'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || 'f72f3755b8e0474a4997ef98f4287249'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><div id="music-player" style="display: none;"></div><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script>  fetch("/music/playlist.json")    .then(response => response.json())    .then(data => {      const ap = new APlayer({        container: document.getElementById("music-player"),        fixed: true,        autoplay: false,        audio: data,        lrcType: 3      });    })    .catch(error => console.error("Error loading playlist:", error));</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>