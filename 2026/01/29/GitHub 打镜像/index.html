<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>GitHub 打镜像 | LiuCheng's Blog</title><meta name="author" content="LiuCheng"><meta name="copyright" content="LiuCheng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="GitHub 容器镜像（GitHub Container Registry）详解一、GitHub 容器镜像服务总览1. GitHub 提供的容器服务123456789GitHub 容器生态系统:┌─────────────────────────────────────────────────────┐│                   GitHub Container Registry">
<meta property="og:type" content="article">
<meta property="og:title" content="GitHub 打镜像">
<meta property="og:url" content="https://mr-liu-cheng.github.io/2026/01/29/GitHub%20%E6%89%93%E9%95%9C%E5%83%8F/">
<meta property="og:site_name" content="LiuCheng&#39;s Blog">
<meta property="og:description" content="GitHub 容器镜像（GitHub Container Registry）详解一、GitHub 容器镜像服务总览1. GitHub 提供的容器服务123456789GitHub 容器生态系统:┌─────────────────────────────────────────────────────┐│                   GitHub Container Registry">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mr-liu-cheng.github.io/img/favicon.png">
<meta property="article:published_time" content="2026-01-29T12:06:02.000Z">
<meta property="article:modified_time" content="2026-01-29T12:06:02.000Z">
<meta property="article:author" content="LiuCheng">
<meta property="article:tag" content="GitHub">
<meta property="article:tag" content="打镜像">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mr-liu-cheng.github.io/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://mr-liu-cheng.github.io/2026/01/29/GitHub%20%E6%89%93%E9%95%9C%E5%83%8F/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-1389699351715193',
  enable_page_level_ads: 'true'
});</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'GitHub 打镜像',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (true) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">64</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">46</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa-solid fa-book"></i><span> Doc</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa-solid fa-timeline"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tag</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa-solid fa-folder-tree"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/game/"><i class="fa-fw fa-solid fa-gamepad"></i><span> Game</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/About/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa-regular fa-pen-to-square"></i><span> More</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/musicPage/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/%E5%BD%B1%E8%A7%86%E5%88%86%E4%BA%AB/"><i class="fa-fw fa-solid fa-film"></i><span> Vidio Sharing</span></a></li><li><a class="site-page child" href="/%E7%BE%8E%E9%A3%9F/"><i class="fa-fw fa-solid fa-mug-hot"></i><span> Delicious</span></a></li><li><a class="site-page child" href="/%E6%B8%B8%E8%AE%B0/"><i class="fa-fw fa-solid fa-person-hiking"></i><span> Tourist</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Calendar/"><i class="fa-fw fa-regular fa-calendar-check"></i><span> Calendar</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/favicon.png" alt="Logo"><span class="site-name">LiuCheng's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">GitHub 打镜像</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa-solid fa-book"></i><span> Doc</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa-solid fa-timeline"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tag</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa-solid fa-folder-tree"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/game/"><i class="fa-fw fa-solid fa-gamepad"></i><span> Game</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/About/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa-regular fa-pen-to-square"></i><span> More</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/musicPage/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/%E5%BD%B1%E8%A7%86%E5%88%86%E4%BA%AB/"><i class="fa-fw fa-solid fa-film"></i><span> Vidio Sharing</span></a></li><li><a class="site-page child" href="/%E7%BE%8E%E9%A3%9F/"><i class="fa-fw fa-solid fa-mug-hot"></i><span> Delicious</span></a></li><li><a class="site-page child" href="/%E6%B8%B8%E8%AE%B0/"><i class="fa-fw fa-solid fa-person-hiking"></i><span> Tourist</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Calendar/"><i class="fa-fw fa-regular fa-calendar-check"></i><span> Calendar</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">GitHub 打镜像</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-01-29T12:06:02.000Z" title="发表于 2026-01-29 12:06:02">2026-01-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-29T12:06:02.000Z" title="更新于 2026-01-29 12:06:02">2026-01-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BB%A3%E7%A0%81%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0/">代码托管平台</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BB%A3%E7%A0%81%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0/GitHub/">GitHub</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BB%A3%E7%A0%81%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0/GitHub/%E6%89%93%E9%95%9C%E5%83%8F/">打镜像</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="GitHub-容器镜像（GitHub-Container-Registry）详解"><a href="#GitHub-容器镜像（GitHub-Container-Registry）详解" class="headerlink" title="GitHub 容器镜像（GitHub Container Registry）详解"></a>GitHub 容器镜像（GitHub Container Registry）详解</h1><h2 id="一、GitHub-容器镜像服务总览"><a href="#一、GitHub-容器镜像服务总览" class="headerlink" title="一、GitHub 容器镜像服务总览"></a>一、GitHub 容器镜像服务总览</h2><h3 id="1-GitHub-提供的容器服务"><a href="#1-GitHub-提供的容器服务" class="headerlink" title="1. GitHub 提供的容器服务"></a>1. <strong>GitHub 提供的容器服务</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GitHub 容器生态系统:</span><br><span class="line">┌─────────────────────────────────────────────────────┐</span><br><span class="line">│                   GitHub Container Registry          │ ← 容器镜像仓库</span><br><span class="line">│                   (ghcr.io)                         │</span><br><span class="line">├─────────────────────────────────────────────────────┤</span><br><span class="line">│                 GitHub Actions                       │ ← CI/CD 流水线</span><br><span class="line">├─────────────────────────────────────────────────────┤</span><br><span class="line">│                GitHub Packages                       │ ← 包管理（包括容器）</span><br><span class="line">└─────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h3 id="2-GitHub-Container-Registry-GHCR-特点"><a href="#2-GitHub-Container-Registry-GHCR-特点" class="headerlink" title="2. GitHub Container Registry (GHCR) 特点"></a>2. <strong>GitHub Container Registry (GHCR) 特点</strong></h3><p><strong>核心优势：</strong></p>
<ul>
<li>✅ <strong>完全免费</strong>（有一定限制）</li>
<li>✅ <strong>与 GitHub 深度集成</strong></li>
<li>✅ <strong>支持私有和公共镜像</strong></li>
<li>✅ <strong>自动安全扫描</strong></li>
<li>✅ <strong>地理冗余存储</strong></li>
</ul>
<p><strong>免费额度（个人账户&#x2F;组织）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">存储: 500 MB 免费</span><br><span class="line">数据传输: 每月 1 GB 免费</span><br><span class="line">               ↓</span><br><span class="line">超出部分才收费，小项目完全够用</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="二、三种创建容器镜像的方式"><a href="#二、三种创建容器镜像的方式" class="headerlink" title="二、三种创建容器镜像的方式"></a>二、三种创建容器镜像的方式</h2><h3 id="方式1：使用-GitHub-Actions-自动构建（推荐）"><a href="#方式1：使用-GitHub-Actions-自动构建（推荐）" class="headerlink" title="方式1：使用 GitHub Actions 自动构建（推荐）"></a>方式1：使用 GitHub Actions 自动构建（推荐）</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .github/workflows/docker-image.yml</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Push</span> <span class="string">Docker</span> <span class="string">Image</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">main</span> ]</span><br><span class="line">    <span class="attr">tags:</span> [ <span class="string">&#x27;v*&#x27;</span> ]</span><br><span class="line">  <span class="attr">pull_request:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">main</span> ]</span><br><span class="line"></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">REGISTRY:</span> <span class="string">ghcr.io</span></span><br><span class="line">  <span class="attr">IMAGE_NAME:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build-and-push:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">permissions:</span></span><br><span class="line">      <span class="attr">contents:</span> <span class="string">read</span></span><br><span class="line">      <span class="attr">packages:</span> <span class="string">write</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># 1. 检出代码</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># 2. 登录到 GitHub Container Registry</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Log</span> <span class="string">in</span> <span class="string">to</span> <span class="string">GHCR</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/login-action@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">registry:</span> <span class="string">ghcr.io</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.actor</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># 3. 设置 Docker 构建参数</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Docker</span> <span class="string">Buildx</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/setup-buildx-action@v3</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># 4. 提取元数据（标签、标签）</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">metadata</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">meta</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/metadata-action@v5</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">images:</span> <span class="string">ghcr.io/$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">tags:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            type=ref,event=branch</span></span><br><span class="line"><span class="string">            type=ref,event=pr</span></span><br><span class="line"><span class="string">            type=semver,pattern=&#123;&#123;version&#125;&#125;</span></span><br><span class="line"><span class="string">            type=semver,pattern=&#123;&#123;major&#125;&#125;.&#123;&#123;minor&#125;&#125;</span></span><br><span class="line"><span class="string">            type=sha,prefix=&#123;&#123;branch&#125;&#125;-</span></span><br><span class="line"><span class="string"></span>      </span><br><span class="line">      <span class="comment"># 5. 构建并推送镜像</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">push</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/build-push-action@v5</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">          <span class="attr">push:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event_name</span> <span class="type">!=</span> <span class="string">&#x27;pull_request&#x27;</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">tags:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.meta.outputs.tags</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">labels:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.meta.outputs.labels</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">cache-from:</span> <span class="string">type=gha</span></span><br><span class="line">          <span class="attr">cache-to:</span> <span class="string">type=gha,mode=max</span></span><br></pre></td></tr></table></figure>

<h3 id="方式2：本地构建后手动推送"><a href="#方式2：本地构建后手动推送" class="headerlink" title="方式2：本地构建后手动推送"></a>方式2：本地构建后手动推送</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 构建镜像（基于项目中的 Dockerfile）</span></span><br><span class="line">docker build -t ghcr.io/your-username/your-image:latest .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 登录 GitHub Container Registry</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;你的个人访问令牌&quot;</span> | docker login ghcr.io -u 你的用户名 --password-stdin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 推送镜像</span></span><br><span class="line">docker push ghcr.io/your-username/your-image:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 查看已推送的镜像</span></span><br><span class="line">docker image <span class="built_in">ls</span> ghcr.io/your-username/your-image</span><br></pre></td></tr></table></figure>

<h3 id="方式3：多架构镜像构建（ARM-AMD）"><a href="#方式3：多架构镜像构建（ARM-AMD）" class="headerlink" title="方式3：多架构镜像构建（ARM&#x2F;AMD）"></a>方式3：多架构镜像构建（ARM&#x2F;AMD）</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .github/workflows/multi-arch.yml</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Build</span> <span class="string">Multi-arch</span> <span class="string">Docker</span> <span class="string">Image</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">strategy:</span></span><br><span class="line">      <span class="attr">matrix:</span></span><br><span class="line">        <span class="attr">platform:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">linux/amd64</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">linux/arm64</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">linux/arm/v7</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">QEMU</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/setup-qemu-action@v3</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Docker</span> <span class="string">Buildx</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/setup-buildx-action@v3</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Login</span> <span class="string">to</span> <span class="string">GHCR</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/login-action@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">registry:</span> <span class="string">ghcr.io</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.actor</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">push</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/build-push-action@v5</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">          <span class="attr">platforms:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.platform</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">push:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">tags:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            ghcr.io/$&#123;&#123; github.repository &#125;&#125;:latest</span></span><br><span class="line"><span class="string">            ghcr.io/$&#123;&#123; github.repository &#125;&#125;:$&#123;&#123; github.sha &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三、完整实战示例：Unity-构建镜像"><a href="#三、完整实战示例：Unity-构建镜像" class="headerlink" title="三、完整实战示例：Unity 构建镜像"></a>三、完整实战示例：Unity 构建镜像</h2><h3 id="1-Dockerfile-示例：Unity-构建环境"><a href="#1-Dockerfile-示例：Unity-构建环境" class="headerlink" title="1. Dockerfile 示例：Unity 构建环境"></a>1. <strong>Dockerfile 示例：Unity 构建环境</strong></h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile.unity-builder</span></span><br><span class="line"><span class="comment"># 阶段1：基础 Unity 环境</span></span><br><span class="line"><span class="keyword">FROM</span> unityci/editor:ubuntu-<span class="number">2021.3</span>.<span class="number">21</span>f1-base-<span class="number">1.0</span>.<span class="number">1</span> AS builder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装额外工具</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    git \</span></span><br><span class="line"><span class="language-bash">    curl \</span></span><br><span class="line"><span class="language-bash">    wget \</span></span><br><span class="line"><span class="language-bash">    zip \</span></span><br><span class="line"><span class="language-bash">    unzip \</span></span><br><span class="line"><span class="language-bash">    python3 \</span></span><br><span class="line"><span class="language-bash">    python3-pip \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /workspace</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制构建脚本</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> BuildScripts/ ./BuildScripts/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> Assets/ ./Assets/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> UNITY_PROJECT_PATH=/workspace</span><br><span class="line"><span class="keyword">ENV</span> OUTPUT_PATH=/output</span><br><span class="line"></span><br><span class="line"><span class="comment"># 阶段2：运行时环境（轻量级）</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">22.04</span> AS runtime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只安装运行时必要的工具</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    ca-certificates \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从构建阶段复制构建好的 AB 包</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /output/ ./ab/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口（如果需要）</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置启动命令</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;-m&quot;</span>, <span class="string">&quot;http.server&quot;</span>, <span class="string">&quot;8080&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="2-GitHub-Actions-工作流配置"><a href="#2-GitHub-Actions-工作流配置" class="headerlink" title="2. GitHub Actions 工作流配置"></a>2. <strong>GitHub Actions 工作流配置</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .github/workflows/unity-ab-pipeline.yml</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Unity</span> <span class="string">AB</span> <span class="string">Pipeline</span> <span class="string">with</span> <span class="string">Docker</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [<span class="string">main</span>, <span class="string">develop</span>]</span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;Assets/**&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;BuildScripts/**&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;Dockerfile.unity-builder&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;.github/workflows/unity-ab-pipeline.yml&#x27;</span></span><br><span class="line">  <span class="attr">release:</span></span><br><span class="line">    <span class="attr">types:</span> [<span class="string">published</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="comment"># 工作流1：构建 Unity AB 包</span></span><br><span class="line">  <span class="attr">build-unity-ab:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">outputs:</span></span><br><span class="line">      <span class="attr">ab_version:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.version.outputs.version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">code</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="string">recursive</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Docker</span> <span class="string">Buildx</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/setup-buildx-action@v3</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">Unity</span> <span class="string">AB</span> <span class="string">Docker</span> <span class="string">image</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          docker build \</span></span><br><span class="line"><span class="string">            -f Dockerfile.unity-builder \</span></span><br><span class="line"><span class="string">            -t unity-ab-builder:latest \</span></span><br><span class="line"><span class="string">            .</span></span><br><span class="line"><span class="string"></span>      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">Unity</span> <span class="string">AB</span> <span class="string">build</span> <span class="string">in</span> <span class="string">container</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          docker run --rm \</span></span><br><span class="line"><span class="string">            -v $(pwd)/output:/output \</span></span><br><span class="line"><span class="string">            unity-ab-builder:latest \</span></span><br><span class="line"><span class="string">            python3 BuildScripts/build_ab.py \</span></span><br><span class="line"><span class="string">              --platform StandaloneWindows64 \</span></span><br><span class="line"><span class="string">              --type Full \</span></span><br><span class="line"><span class="string">              --version 1.0.$&#123;&#123; github.run_number &#125;&#125;</span></span><br><span class="line"><span class="string"></span>      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">version</span> <span class="string">info</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">version</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          echo &quot;version=1.0.$&#123;&#123; github.run_number &#125;&#125;&quot; &gt;&gt; $GITHUB_OUTPUT</span></span><br><span class="line"><span class="string"></span>  </span><br><span class="line">  <span class="comment"># 工作流2：构建并推送 Docker 镜像</span></span><br><span class="line">  <span class="attr">build-and-push-docker:</span></span><br><span class="line">    <span class="attr">needs:</span> <span class="string">build-unity-ab</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">permissions:</span></span><br><span class="line">      <span class="attr">contents:</span> <span class="string">read</span></span><br><span class="line">      <span class="attr">packages:</span> <span class="string">write</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">code</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Download</span> <span class="string">AB</span> <span class="string">artifacts</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/download-artifact@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">ab-output</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">output/</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Docker</span> <span class="string">Buildx</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/setup-buildx-action@v3</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Login</span> <span class="string">to</span> <span class="string">GHCR</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/login-action@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">registry:</span> <span class="string">ghcr.io</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.actor</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">metadata</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">meta</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/metadata-action@v5</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">images:</span> <span class="string">ghcr.io/$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">tags:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            type=raw,value=$&#123;&#123; needs.build-unity-ab.outputs.ab_version &#125;&#125;</span></span><br><span class="line"><span class="string">            type=raw,value=latest</span></span><br><span class="line"><span class="string">            type=sha,prefix=&#123;&#123;branch&#125;&#125;-</span></span><br><span class="line"><span class="string"></span>      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">push</span> <span class="string">AB</span> <span class="string">runtime</span> <span class="string">image</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/build-push-action@v5</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">          <span class="attr">file:</span> <span class="string">Dockerfile.runtime</span></span><br><span class="line">          <span class="attr">push:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">tags:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.meta.outputs.tags</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">labels:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.meta.outputs.labels</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">build-args:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            AB_VERSION=$&#123;&#123; needs.build-unity-ab.outputs.ab_version &#125;&#125;</span></span><br><span class="line"><span class="string"></span>  </span><br><span class="line">  <span class="comment"># 工作流3：部署到测试环境</span></span><br><span class="line">  <span class="attr">deploy-to-test:</span></span><br><span class="line">    <span class="attr">needs:</span> <span class="string">build-and-push-docker</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">environment:</span> <span class="string">test</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">to</span> <span class="string">test</span> <span class="string">environment</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          echo &quot;部署镜像到测试环境...&quot;</span></span><br><span class="line"><span class="string">          echo &quot;镜像: ghcr.io/$&#123;&#123; github.repository &#125;&#125;:$&#123;&#123; needs.build-unity-ab.outputs.ab_version &#125;&#125;&quot;</span></span><br><span class="line"><span class="string">          # 这里可以是实际的部署命令，如：</span></span><br><span class="line"><span class="string">          # kubectl set image deployment/my-game ab-server=ghcr.io/...</span></span><br></pre></td></tr></table></figure>

<h3 id="3-多阶段构建优化"><a href="#3-多阶段构建优化" class="headerlink" title="3. 多阶段构建优化"></a>3. <strong>多阶段构建优化</strong></h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile.optimized</span></span><br><span class="line"><span class="comment"># 阶段1：依赖安装</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span>-alpine AS deps</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package*.json ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm ci --only=production</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 阶段2：构建应用</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span>-alpine AS builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=deps /app/node_modules ./node_modules</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 阶段3：运行时镜像（最小化）</span></span><br><span class="line"><span class="keyword">FROM</span> nginx:alpine AS runner</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/dist /usr/share/nginx/html</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> nginx.conf /etc/nginx/conf.d/default.conf</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四、GitHub-Packages-与-GHCR-对比"><a href="#四、GitHub-Packages-与-GHCR-对比" class="headerlink" title="四、GitHub Packages 与 GHCR 对比"></a>四、GitHub Packages 与 GHCR 对比</h2><h3 id="功能对比表"><a href="#功能对比表" class="headerlink" title="功能对比表"></a>功能对比表</h3><table>
<thead>
<tr>
<th>特性</th>
<th>GitHub Container Registry (GHCR)</th>
<th>GitHub Packages (Docker)</th>
<th>Docker Hub</th>
</tr>
</thead>
<tbody><tr>
<td><strong>完全免费额度</strong></td>
<td>500 MB + 1 GB&#x2F;月</td>
<td>同 GHCR</td>
<td>有限免费（需订阅）</td>
</tr>
<tr>
<td><strong>私有仓库</strong></td>
<td>✅ 无限</td>
<td>✅ 无限</td>
<td>❌ 有限制</td>
</tr>
<tr>
<td><strong>公共仓库</strong></td>
<td>✅ 无限</td>
<td>✅ 无限</td>
<td>✅ 无限</td>
</tr>
<tr>
<td><strong>与 GitHub 集成</strong></td>
<td>✅ 深度集成</td>
<td>✅ 集成</td>
<td>❌ 有限</td>
</tr>
<tr>
<td><strong>自动安全扫描</strong></td>
<td>✅ 高级扫描</td>
<td>✅ 基础扫描</td>
<td>✅ 需付费</td>
</tr>
<tr>
<td><strong>地理冗余</strong></td>
<td>✅ 自动</td>
<td>✅ 自动</td>
<td>❌ 有限</td>
</tr>
<tr>
<td><strong>访问控制</strong></td>
<td>✅ 精细控制</td>
<td>✅ 精细控制</td>
<td>✅ 基础控制</td>
</tr>
<tr>
<td><strong>Webhooks</strong></td>
<td>✅ 支持</td>
<td>✅ 支持</td>
<td>✅ 支持</td>
</tr>
<tr>
<td><strong>使用率统计</strong></td>
<td>✅ 详细</td>
<td>✅ 详细</td>
<td>✅ 详细</td>
</tr>
</tbody></table>
<h3 id="迁移指南：从-Docker-Hub-到-GHCR"><a href="#迁移指南：从-Docker-Hub-到-GHCR" class="headerlink" title="迁移指南：从 Docker Hub 到 GHCR"></a>迁移指南：从 Docker Hub 到 GHCR</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 从 Docker Hub 拉取现有镜像</span></span><br><span class="line">docker pull username/image:tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 重新标记为 GHCR 格式</span></span><br><span class="line">docker tag username/image:tag ghcr.io/your-username/image:tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 登录 GHCR</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$GHCR_TOKEN</span> | docker login ghcr.io -u your-username --password-stdin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 推送到 GHCR</span></span><br><span class="line">docker push ghcr.io/your-username/image:tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 更新你的部署配置</span></span><br><span class="line"><span class="comment"># 之前: image: username/image:tag</span></span><br><span class="line"><span class="comment"># 之后: image: ghcr.io/your-username/image:tag</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五、访问控制与权限管理"><a href="#五、访问控制与权限管理" class="headerlink" title="五、访问控制与权限管理"></a>五、访问控制与权限管理</h2><h3 id="1-访问令牌类型"><a href="#1-访问令牌类型" class="headerlink" title="1. 访问令牌类型"></a>1. <strong>访问令牌类型</strong></h3><table>
<thead>
<tr>
<th>令牌类型</th>
<th>用途</th>
<th>权限范围</th>
<th>示例用途</th>
</tr>
</thead>
<tbody><tr>
<td><strong>GITHUB_TOKEN</strong></td>
<td>Actions 自动认证</td>
<td>当前仓库</td>
<td>CI&#x2F;CD 流水线</td>
</tr>
<tr>
<td><strong>个人访问令牌</strong></td>
<td>手动操作&#x2F;脚本</td>
<td>可配置范围</td>
<td>本地推送镜像</td>
</tr>
<tr>
<td><strong>部署密钥</strong></td>
<td>只读访问</td>
<td>单个仓库</td>
<td>生产环境拉取</td>
</tr>
</tbody></table>
<h3 id="2-权限配置示例"><a href="#2-权限配置示例" class="headerlink" title="2. 权限配置示例"></a>2. <strong>权限配置示例</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 GitHub Actions 中配置权限</span></span><br><span class="line"><span class="attr">permissions:</span></span><br><span class="line">  <span class="comment"># 容器镜像权限</span></span><br><span class="line">  <span class="attr">packages:</span> <span class="string">write</span>    <span class="comment"># 允许推送镜像</span></span><br><span class="line">  <span class="attr">contents:</span> <span class="string">read</span>     <span class="comment"># 允许读取代码</span></span><br><span class="line">  <span class="attr">actions:</span> <span class="string">read</span>      <span class="comment"># 允许读取 Actions</span></span><br><span class="line">  <span class="attr">checks:</span> <span class="string">write</span>      <span class="comment"># 允许写入检查结果</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 或者使用预设权限级别</span></span><br><span class="line">  <span class="attr">id-token:</span> <span class="string">write</span>    <span class="comment"># OIDC token 用于云提供商认证</span></span><br></pre></td></tr></table></figure>

<h3 id="3-组织级权限管理"><a href="#3-组织级权限管理" class="headerlink" title="3. 组织级权限管理"></a>3. <strong>组织级权限管理</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 组织设置 → Packages → 权限管理</span></span><br><span class="line"><span class="string">权限结构:</span></span><br><span class="line"><span class="string">组织</span> <span class="string">(your-org)</span></span><br><span class="line"><span class="string">├──</span> <span class="string">包仓库</span> <span class="string">(ghcr.io/your-org/base-image)</span></span><br><span class="line"><span class="string">│</span>   <span class="string">├──</span> <span class="string">管理员:</span> <span class="string">team-devops</span></span><br><span class="line"><span class="string">│</span>   <span class="string">├──</span> <span class="string">写入:</span> <span class="string">team-backend</span></span><br><span class="line"><span class="string">│</span>   <span class="string">└──</span> <span class="string">读取:</span> <span class="string">team-frontend</span></span><br><span class="line"><span class="string">├──</span> <span class="string">包仓库</span> <span class="string">(ghcr.io/your-org/web-app)</span></span><br><span class="line"><span class="string">│</span>   <span class="string">├──</span> <span class="string">管理员:</span> <span class="string">team-frontend</span></span><br><span class="line"><span class="string">│</span>   <span class="string">└──</span> <span class="string">读取:</span> <span class="string">team-qa</span></span><br><span class="line"><span class="string">└──</span> <span class="string">包仓库</span> <span class="string">(ghcr.io/your-org/database)</span></span><br><span class="line">    <span class="string">├──</span> <span class="string">管理员:</span> <span class="string">team-dba</span></span><br><span class="line">    <span class="string">└──</span> <span class="string">读取:</span> <span class="string">team-backend</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="六、镜像管理与维护"><a href="#六、镜像管理与维护" class="headerlink" title="六、镜像管理与维护"></a>六、镜像管理与维护</h2><h3 id="1-标签策略最佳实践"><a href="#1-标签策略最佳实践" class="headerlink" title="1. 标签策略最佳实践"></a>1. <strong>标签策略最佳实践</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推荐标签命名规则</span></span><br><span class="line"><span class="attr">tags:</span> <span class="string">|</span></span><br><span class="line"><span class="string">  # 语义化版本</span></span><br><span class="line"><span class="string">  type=semver,pattern=&#123;&#123;version&#125;&#125;              # v1.2.3</span></span><br><span class="line"><span class="string">  type=semver,pattern=&#123;&#123;major&#125;&#125;.&#123;&#123;minor&#125;&#125;      # v1.2</span></span><br><span class="line"><span class="string">  type=semver,pattern=&#123;&#123;major&#125;&#125;                # v1</span></span><br><span class="line"><span class="string"></span>  </span><br><span class="line">  <span class="comment"># 分支标签</span></span><br><span class="line">  <span class="string">type=ref,event=branch</span>                        <span class="comment"># main, develop</span></span><br><span class="line">  <span class="string">type=ref,event=tag</span>                           <span class="comment"># 从标签触发</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 提交哈希</span></span><br><span class="line">  <span class="string">type=sha,prefix=sha-</span>                         <span class="comment"># sha-abc123</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 环境标签</span></span><br><span class="line">  <span class="string">type=raw,value=latest</span>                        <span class="comment"># 最新稳定版</span></span><br><span class="line">  <span class="string">type=raw,value=nightly</span>                       <span class="comment"># 每日构建</span></span><br></pre></td></tr></table></figure>

<h3 id="2-自动清理旧镜像"><a href="#2-自动清理旧镜像" class="headerlink" title="2. 自动清理旧镜像"></a>2. <strong>自动清理旧镜像</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .github/workflows/cleanup-images.yml</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Cleanup</span> <span class="string">Old</span> <span class="string">Docker</span> <span class="string">Images</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">schedule:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">cron:</span> <span class="string">&#x27;0 3 * * 0&#x27;</span>  <span class="comment"># 每周日凌晨3点</span></span><br><span class="line">  <span class="attr">workflow_dispatch:</span>      <span class="comment"># 手动触发</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">cleanup:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">permissions:</span></span><br><span class="line">      <span class="attr">packages:</span> <span class="string">write</span></span><br><span class="line">      <span class="attr">contents:</span> <span class="string">read</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cleanup</span> <span class="string">old</span> <span class="string">images</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">snok/container-retention-policy@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="comment"># 保留策略</span></span><br><span class="line">          <span class="attr">image-names:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            ghcr.io/$&#123;&#123; github.repository &#125;&#125;/*</span></span><br><span class="line"><span class="string"></span>          </span><br><span class="line">          <span class="comment"># 保留规则</span></span><br><span class="line">          <span class="attr">keep-at-least:</span> <span class="number">10</span>           <span class="comment"># 至少保留10个镜像</span></span><br><span class="line">          <span class="attr">keep-tags:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            ^latest$                  # 保留 latest 标签</span></span><br><span class="line"><span class="string">            ^v[0-9]+\.[0-9]+\.[0-9]+$ # 保留正式版本</span></span><br><span class="line"><span class="string">            ^main$                    # 保留 main 分支构建</span></span><br><span class="line"><span class="string"></span>          </span><br><span class="line">          <span class="comment"># 删除规则</span></span><br><span class="line">          <span class="attr">cut-off:</span> <span class="string">P30D</span>               <span class="comment"># 删除30天前的镜像</span></span><br><span class="line">          <span class="attr">dry-run:</span> <span class="literal">false</span>              <span class="comment"># 实际执行删除</span></span><br></pre></td></tr></table></figure>

<h3 id="3-镜像安全扫描"><a href="#3-镜像安全扫描" class="headerlink" title="3. 镜像安全扫描"></a>3. <strong>镜像安全扫描</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .github/workflows/security-scan.yml</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Security</span> <span class="string">Scan</span> <span class="string">Docker</span> <span class="string">Images</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [<span class="string">main</span>]</span><br><span class="line">    <span class="attr">tags:</span> [<span class="string">v*</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">scan:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">code</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">Docker</span> <span class="string">image</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">-t</span> <span class="string">myapp:latest</span> <span class="string">.</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># 使用 Trivy 扫描</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">Trivy</span> <span class="string">vulnerability</span> <span class="string">scanner</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">aquasecurity/trivy-action@master</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">image-ref:</span> <span class="string">&#x27;myapp:latest&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;sarif&#x27;</span></span><br><span class="line">          <span class="attr">output:</span> <span class="string">&#x27;trivy-results.sarif&#x27;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># 使用 Grype 扫描</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">Grype</span> <span class="string">vulnerability</span> <span class="string">scanner</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">anchore/scan-action@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line">          <span class="attr">fail-build:</span> <span class="literal">false</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># 上传安全扫描结果</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Upload</span> <span class="string">SARIF</span> <span class="string">results</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">github/codeql-action/upload-sarif@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">sarif_file:</span> <span class="string">trivy-results.sarif</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="七、高级使用场景"><a href="#七、高级使用场景" class="headerlink" title="七、高级使用场景"></a>七、高级使用场景</h2><h3 id="1-跨仓库共享基础镜像"><a href="#1-跨仓库共享基础镜像" class="headerlink" title="1. 跨仓库共享基础镜像"></a>1. <strong>跨仓库共享基础镜像</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仓库A：构建基础镜像</span></span><br><span class="line"><span class="comment"># Dockerfile.base</span></span><br><span class="line"><span class="string">FROM</span> <span class="string">ubuntu:22.04</span></span><br><span class="line"><span class="string">RUN</span> <span class="string">apt-get</span> <span class="string">update</span> <span class="string">&amp;&amp;</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="string">-y</span> <span class="string">\</span></span><br><span class="line">    <span class="string">python3</span> <span class="string">python3-pip</span> <span class="string">nodejs</span> <span class="string">npm</span></span><br><span class="line"><span class="comment"># 推送到：ghcr.io/org/base-image:latest</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 仓库B：使用基础镜像</span></span><br><span class="line"><span class="comment"># Dockerfile.app</span></span><br><span class="line"><span class="string">FROM</span> <span class="string">ghcr.io/org/base-image:latest</span> <span class="string">AS</span> <span class="string">builder</span></span><br><span class="line"><span class="string">WORKDIR</span> <span class="string">/app</span></span><br><span class="line"><span class="string">COPY</span> <span class="string">.</span> <span class="string">.</span></span><br><span class="line"><span class="string">RUN</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">&amp;&amp;</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line"><span class="string">FROM</span> <span class="string">nginx:alpine</span></span><br><span class="line"><span class="string">COPY</span> <span class="string">--from=builder</span> <span class="string">/app/dist</span> <span class="string">/usr/share/nginx/html</span></span><br></pre></td></tr></table></figure>

<h3 id="2-使用缓存加速构建"><a href="#2-使用缓存加速构建" class="headerlink" title="2. 使用缓存加速构建"></a>2. <strong>使用缓存加速构建</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用 GitHub Actions 缓存</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Docker</span> <span class="string">Buildx</span> <span class="string">with</span> <span class="string">cache</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">docker/setup-buildx-action@v3</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">driver-opts:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      image=moby/buildkit:latest</span></span><br><span class="line"><span class="string">      # 使用 GitHub Actions 缓存</span></span><br><span class="line"><span class="string">      cache-from=type=gha</span></span><br><span class="line"><span class="string">      cache-to=type=gha,mode=max</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="comment"># 或者使用外部缓存</span></span><br><span class="line"><span class="attr">cache-from:</span> <span class="string">|</span></span><br><span class="line"><span class="string">  type=registry,ref=ghcr.io/$&#123;&#123; github.repository &#125;&#125;:buildcache</span></span><br><span class="line"><span class="string"></span><span class="attr">cache-to:</span> <span class="string">|</span></span><br><span class="line">  <span class="string">type=registry,ref=ghcr.io/$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;:buildcache,mode=max</span></span><br></pre></td></tr></table></figure>

<h3 id="3-多云部署策略"><a href="#3-多云部署策略" class="headerlink" title="3. 多云部署策略"></a>3. <strong>多云部署策略</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署到多个云平台</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">matrix:</span></span><br><span class="line">      <span class="attr">cloud:</span> [<span class="string">aws</span>, <span class="string">azure</span>, <span class="string">gcp</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Authenticate</span> <span class="string">to</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.cloud</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">docker/login-action@v3</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="comment"># 使用 OIDC 进行云认证</span></span><br><span class="line">        <span class="attr">registry:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.cloud</span> <span class="string">==</span> <span class="string">&#x27;aws&#x27;</span> <span class="string">&amp;&amp;</span> <span class="string">&#x27;public.ecr.aws&#x27;</span> <span class="string">||</span> </span><br><span class="line">                    <span class="string">matrix.cloud</span> <span class="string">==</span> <span class="string">&#x27;azure&#x27;</span> <span class="string">&amp;&amp;</span> <span class="string">&#x27;azurecr.io&#x27;</span> <span class="string">||</span> </span><br><span class="line">                    <span class="string">matrix.cloud</span> <span class="string">==</span> <span class="string">&#x27;gcp&#x27;</span> <span class="string">&amp;&amp;</span> <span class="string">&#x27;gcr.io&#x27;</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Push</span> <span class="string">to</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.cloud</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        # 从 GHCR 拉取</span></span><br><span class="line"><span class="string">        docker pull ghcr.io/$&#123;&#123; github.repository &#125;&#125;:$&#123;&#123; env.VERSION &#125;&#125;</span></span><br><span class="line"><span class="string"></span>        </span><br><span class="line">        <span class="comment"># 重新打标签</span></span><br><span class="line">        <span class="string">docker</span> <span class="string">tag</span> <span class="string">ghcr.io/$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;:$&#123;&#123;</span> <span class="string">env.VERSION</span> <span class="string">&#125;&#125;</span> <span class="string">\</span></span><br><span class="line">                   <span class="string">$&#123;&#123;</span> <span class="string">matrix.cloud.registry</span> <span class="string">&#125;&#125;/$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;:$&#123;&#123;</span> <span class="string">env.VERSION</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 推送到目标云</span></span><br><span class="line">        <span class="string">docker</span> <span class="string">push</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.cloud.registry</span> <span class="string">&#125;&#125;/$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;:$&#123;&#123;</span> <span class="string">env.VERSION</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="八、成本优化策略"><a href="#八、成本优化策略" class="headerlink" title="八、成本优化策略"></a>八、成本优化策略</h2><h3 id="1-镜像层优化技巧"><a href="#1-镜像层优化技巧" class="headerlink" title="1. 镜像层优化技巧"></a>1. <strong>镜像层优化技巧</strong></h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 优化前的 Dockerfile（问题示例）</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">22.04</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y python3  <span class="comment"># ❌ 分开 RUN 命令</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y nodejs   <span class="comment"># ❌ 创建多层</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y git      <span class="comment"># ❌ 每层都增加大小</span></span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package.json .             <span class="comment"># ❌ 频繁变更的层放前面</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install                 <span class="comment"># ❌ 每次构建都执行</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化后的 Dockerfile（最佳实践）</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">22.04</span> AS builder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 合并 RUN 命令，清理缓存</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get install -y \</span></span><br><span class="line"><span class="language-bash">        python3 \</span></span><br><span class="line"><span class="language-bash">        nodejs \</span></span><br><span class="line"><span class="language-bash">        git \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 分离依赖安装和代码复制</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package*.json ./          <span class="comment"># ✅ 依赖文件单独复制</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm ci --only=production   <span class="comment"># ✅ 使用 ci 更稳定</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 代码放在后面（变更频繁）</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .                       <span class="comment"># ✅ 代码层在依赖层之后</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 多阶段构建减小最终镜像</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span>-alpine AS runner  <span class="comment"># ✅ 使用更小的基础镜像</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app /app</span></span><br></pre></td></tr></table></figure>

<h3 id="2-存储成本控制"><a href="#2-存储成本控制" class="headerlink" title="2. 存储成本控制"></a>2. <strong>存储成本控制</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看镜像大小</span></span><br><span class="line">docker images --format <span class="string">&quot;table &#123;&#123;.Repository&#125;&#125;\t&#123;&#123;.Tag&#125;&#125;\t&#123;&#123;.Size&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理无用镜像</span></span><br><span class="line">docker image prune -a --filter <span class="string">&quot;until=24h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 dive 分析镜像层</span></span><br><span class="line">docker run --<span class="built_in">rm</span> -it \</span><br><span class="line">    -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">    wagoodman/dive:latest ghcr.io/your-org/image:latest</span><br></pre></td></tr></table></figure>

<h3 id="3-传输成本优化"><a href="#3-传输成本优化" class="headerlink" title="3. 传输成本优化"></a>3. <strong>传输成本优化</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用内容寻址存储减少重复传输</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">with</span> <span class="string">content-based</span> <span class="string">tagging</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    # 构建时不指定标签</span></span><br><span class="line"><span class="string">    docker build -t myapp .</span></span><br><span class="line"><span class="string"></span>    </span><br><span class="line">    <span class="comment"># 获取镜像摘要（唯一ID）</span></span><br><span class="line">    <span class="string">DIGEST=$(docker</span> <span class="string">inspect</span> <span class="string">myapp</span> <span class="string">--format=&#x27;&#123;&#123;.Id&#125;&#125;&#x27;)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用摘要作为标签</span></span><br><span class="line">    <span class="string">docker</span> <span class="string">tag</span> <span class="string">myapp</span> <span class="string">ghcr.io/$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;@$&#123;DIGEST&#125;</span></span><br><span class="line">    <span class="string">docker</span> <span class="string">push</span> <span class="string">ghcr.io/$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;@$&#123;DIGEST&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="九、故障排查与监控"><a href="#九、故障排查与监控" class="headerlink" title="九、故障排查与监控"></a>九、故障排查与监控</h2><h3 id="1-常见问题解决"><a href="#1-常见问题解决" class="headerlink" title="1. 常见问题解决"></a>1. <strong>常见问题解决</strong></h3><table>
<thead>
<tr>
<th>问题</th>
<th>原因</th>
<th>解决方案</th>
</tr>
</thead>
<tbody><tr>
<td><strong>推送失败：denied</strong></td>
<td>权限不足</td>
<td>检查 GITHUB_TOKEN 或 PAT 权限</td>
</tr>
<tr>
<td><strong>镜像过大超限</strong></td>
<td>超过免费额度</td>
<td>优化镜像大小，删除旧镜像</td>
</tr>
<tr>
<td><strong>构建超时</strong></td>
<td>网络问题或构建复杂</td>
<td>增加 timeout，使用镜像缓存</td>
</tr>
<tr>
<td><strong>安全扫描失败</strong></td>
<td>存在高危漏洞</td>
<td>更新基础镜像，修复漏洞</td>
</tr>
<tr>
<td><strong>拉取缓慢</strong></td>
<td>地理距离远</td>
<td>使用镜像加速器或 CDN</td>
</tr>
</tbody></table>
<h3 id="2-监控指标"><a href="#2-监控指标" class="headerlink" title="2. 监控指标"></a>2. <strong>监控指标</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 GitHub API 监控使用情况</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Check</span> <span class="string">package</span> <span class="string">usage</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    curl -s -H &quot;Authorization: token $&#123;&#123; secrets.GH_TOKEN &#125;&#125;&quot; \</span></span><br><span class="line"><span class="string">      https://api.github.com/users/$&#123;&#123; github.actor &#125;&#125;/packages?package_type=container \</span></span><br><span class="line"><span class="string">      | jq &#x27;.[] | &#123;name: .name, version_count: .version_count&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-日志与调试"><a href="#3-日志与调试" class="headerlink" title="3. 日志与调试"></a>3. <strong>日志与调试</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用详细日志</span></span><br><span class="line">docker build --progress=plain --no-cache -t myapp .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 Actions 日志</span></span><br><span class="line">gh run view --<span class="built_in">log</span> <span class="variable">$RUN_ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查镜像元数据</span></span><br><span class="line">docker inspect ghcr.io/username/image:tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看镜像历史</span></span><br><span class="line">docker <span class="built_in">history</span> ghcr.io/username/image:tag --no-trunc</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十、完整实战工作流"><a href="#十、完整实战工作流" class="headerlink" title="十、完整实战工作流"></a>十、完整实战工作流</h2><h3 id="企业级镜像流水线"><a href="#企业级镜像流水线" class="headerlink" title="企业级镜像流水线"></a>企业级镜像流水线</h3><pre><code class="highlight mermaid">graph TD
    A[代码提交到 GitHub] --&gt; B&#123;GitHub Actions 触发&#125;
    B --&gt; C[代码质量检查]
    C --&gt; D[构建 Docker 镜像]
    D --&gt; E[安全漏洞扫描]
    E --&gt; F&#123;扫描通过?&#125;
    F --&gt;|是| G[推送到 GHCR]
    F --&gt;|否| H[通知开发团队]
    G --&gt; I[部署到测试环境]
    I --&gt; J[自动化测试]
    J --&gt; K&#123;测试通过?&#125;
    K --&gt;|是| L[推送到生产环境]
    K --&gt;|否| M[回滚并通知]
    L --&gt; N[监控运行状态]
    
    style A fill:#f9f,stroke:#333
    style L fill:#9f9,stroke:#333
    style H fill:#f99,stroke:#333</code></pre>

<h3 id="配置清单总结"><a href="#配置清单总结" class="headerlink" title="配置清单总结"></a>配置清单总结</h3><ol>
<li><p><strong>必须文件</strong>：</p>
<ul>
<li><code>.github/workflows/docker.yml</code> - CI&#x2F;CD 配置</li>
<li><code>Dockerfile</code> - 镜像构建定义</li>
<li><code>.dockerignore</code> - 排除不必要的文件</li>
</ul>
</li>
<li><p><strong>推荐配置</strong>：</p>
<ul>
<li><code>docker-compose.yml</code> - 本地开发环境</li>
<li><code>Makefile</code> - 构建命令封装</li>
<li><code>scripts/</code> - 辅助脚本目录</li>
</ul>
</li>
<li><p><strong>安全配置</strong>：</p>
<ul>
<li>GitHub Secrets（存储敏感信息）</li>
<li>代码签名（可选）</li>
<li>访问控制策略</li>
</ul>
</li>
</ol>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>GitHub Container Registry 的核心优势：</strong></p>
<ol>
<li><strong>无缝集成</strong> - 与 GitHub Actions、Packages 深度集成</li>
<li><strong>成本效益</strong> - 对开源项目和小团队完全免费</li>
<li><strong>安全性</strong> - 内置漏洞扫描和访问控制</li>
<li><strong>易用性</strong> - 使用熟悉的 GitHub 界面和 API</li>
</ol>
<p><strong>使用建议：</strong></p>
<ul>
<li>小型项目&#x2F;初创公司 → <strong>直接使用 GHCR</strong></li>
<li>企业级应用 → <strong>GHCR + 自建镜像仓库混合</strong></li>
<li>需要多云部署 → <strong>GHCR 作为主仓库，同步到各云</strong></li>
</ul>
<p><strong>一句话总结：</strong> GitHub 不仅可以打镜像，而且提供了一套完整的、与代码仓库深度集成的容器镜像解决方案，特别适合 GitOps 和 DevOps 工作流。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mr-liu-cheng.github.io">LiuCheng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mr-liu-cheng.github.io/2026/01/29/GitHub%20%E6%89%93%E9%95%9C%E5%83%8F/">https://mr-liu-cheng.github.io/2026/01/29/GitHub%20%E6%89%93%E9%95%9C%E5%83%8F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://mr-liu-cheng.github.io" target="_blank">LiuCheng's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/GitHub/">GitHub</a><a class="post-meta__tags" href="/tags/%E6%89%93%E9%95%9C%E5%83%8F/">打镜像</a></div><div class="post-share"><div class="social-share" data-image="/img/favicon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxpay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wxpay.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/01/29/GitLab%20vs%20GitHub/" title="GitLab vs GitHub"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">GitLab vs GitHub</div></div><div class="info-2"><div class="info-item-1">GitLab vs GitHub：全面对比详解一、一句话概括核心区别GitHub &#x3D; 代码托管平台 + 社交协作网络GitLab &#x3D; 一体化 DevOps 平台 + 自托管能力  二、核心对比速查表   对比维度 GitHub GitLab 谁更适合    核心定位 代码社交平台 完整 DevOps 平台 看需求   部署方式 仅云端 SaaS SaaS + 自托管 GitLab 灵活   商业模式 免费+付费 SaaS 免费自托管+付费 SaaS 各有所长   CI&#x2F;CD GitHub Actions GitLab CI&#x2F;CD GitLab 更强   项目管理 Issues+Projects 完整项目群组 GitLab 完整   安全功能 基础安全扫描 全生命周期安全 GitLab 全面   社区生态 全球最大 快速增长 GitHub 领先   企业特性 GitHub Enterprise GitLab Ultimate GitLab 更专业    三、详细对比分析1....</div></div></div></a><a class="pagination-related" href="/2026/01/30/%E6%B8%B8%E6%88%8F%E7%83%AD%E6%9B%B4%E8%B5%84%E6%BA%90%E5%AD%98%E5%82%A8%E4%B8%8E%E5%88%86%E5%8F%91%E7%B3%BB%E7%BB%9F/" title="游戏热更资源存储与分发系统"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">游戏热更资源存储与分发系统</div></div><div class="info-2"><div class="info-item-1">游戏热更资源存储与分发系统详解一、这类系统的专业名称1. 通用技术名称   类型 专业名称 通俗叫法 代表产品    对象存储 Object Storage Service (OSS) 云存储、文件云 AWS S3、阿里云OSS、腾讯云COS   文件传输 Managed File Transfer (MFT) FTP服务器 FileZilla Server、VSFTPD   内容分发 Content Delivery Network (CDN) 加速网络、分发网络 Cloudflare、Akamai、阿里云CDN   热更系统 Hot Update&#x2F;Patch Distribution System 补丁系统、更新系统 自研居多   2. 游戏行业专用术语完整的技术栈名称： 12345游戏资源热更系统 =   资源存储层 (Object Storage) + 资源分发层 (CDN/边缘计算) + 版本管理服务 (Patch Management Service)+ 客户端更新器 (Game Launcher/Updater)   二、核心组件详解1....</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/05/08/GitHub%20Actions%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/" title="GitHub Actions部署流程"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-08</div><div class="info-item-2">GitHub Actions部署流程</div></div><div class="info-2"><div class="info-item-1">我们来逐步解读你提供的 GitHub Actions 自动部署 Hexo 博客的完整脚本，帮助你理解每一步在干什么、为什么需要它：  🧾 YAML 脚本结构快速回顾123456name: Deploy Hexo to GitHub Pageson:  push:    branches:      - master  ✅ 含义： name: 工作流的名称，显示在 GitHub Actions 页中。 on.push.branches: 表示当你向 master 分支推送代码时，会自动触发这个部署工作流。   123jobs:  build:    runs-on: ubuntu-latest  ✅ 含义： 定义了一个名为 build 的任务（job） runs-on: ubuntu-latest 表示 GitHub 提供的云服务器上使用最新的 Ubuntu 系统执行任务   🚀 核心步骤一览 1️⃣ 获取仓库代码12- name: Checkout repository  uses: actions/checkout@v2  ✅ 使用官方的 checkout Action...</div></div></div></a><a class="pagination-related" href="/2025/05/08/GitHub%20Actions%20%E6%B2%A1%E6%9C%89%E8%A7%A6%E5%8F%91/" title="GitHub Actions 没有触发的核心原因"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-08</div><div class="info-item-2">GitHub Actions 没有触发的核心原因</div></div><div class="info-2"><div class="info-item-1">谢谢提供路径信息。 你的 GitHub Actions 没有触发的核心原因在于：  你把 deploy.yml 放在了 mr-liu-cheng.github.io/blog/.github/workflows/deploy.yml而它 应该放在仓库根目录下的 .github/workflows/ 中，即：✅ 正确路径是： 1mr-liu-cheng.github.io/.github/workflows/deploy.yml   🔧 为什么要这样放？GitHub Actions 的工作流只会被识别和执行 主仓库 .github/workflows/ 目录下的 YAML 文件，这是固定机制，不能嵌套到子目录或子文件夹里（比如你现在的 blog/ 子目录）。  ✅ 修复步骤（只需一次性修改）你可以按下面操作调整： ① 把 deploy.yml 移动到主目录 .github/workflows/：123# 从 blog 子目录移回仓库根目录mkdir -p .github/workflowsmv blog/.github/workflows/deploy.yml...</div></div></div></a><a class="pagination-related" href="/2025/05/12/GitHub%20action%20%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83%E5%8D%9A%E5%AE%A2/" title="GitHub action 自动发布博客"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">GitHub action 自动发布博客</div></div><div class="info-2"><div class="info-item-1">完整推荐如下： ✅ 推荐版本（添加 clean、修正路径） name: Deploy Hexo Blog to GitHub Pages on:  push:    branches:      - master jobs:  build-deploy:    runs-on: ubuntu-latest steps:   - name: Checkout repository     uses: actions/checkout@v3    - name: Setup Node.js     uses: actions/setup-node@v3     with:       node-version: 18    - name: Install Hexo CLI     run: npm install -g hexo-cli    - name: Install dependencies     run: npm install     working-directory: blog    - name: Clean previous builds     run:...</div></div></div></a><a class="pagination-related" href="/2025/01/22/GitHub%E4%BD%9C%E4%B8%BA%E7%83%AD%E6%9B%B4%E6%9C%8D%E5%8A%A1%E5%99%A8/" title="GitHub 作为热更服务器"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-22</div><div class="info-item-2">GitHub 作为热更服务器</div></div><div class="info-2"><div class="info-item-1">要使用 GitHub 作为 Unity 项目的热更新资源服务器，你可以通过 GitHub 的 Releases 功能来托管和管理资源（如 AssetBundles）。这样，你可以通过 Unity 在运行时动态下载这些资源，而无需每次更新游戏客户端。下面是如何使用 GitHub 来托管 Unity 热更新资源的详细步骤： 1. 准备资源（例如 AssetBundles）首先，你需要将 Unity 项目的资源打包成 AssetBundles。这是 Unity 热更新的常见方式。通过 AssetBundles，你可以在游戏运行时动态加载资源，而不需要重新发布整个游戏。 创建 AssetBundles： 在 Unity 中创建 AssetBundle：  选择你想要打包的资源（例如场景、模型、纹理等）。 在 Inspector 面板中，给它们指定一个 AssetBundle 名称。例如，将所有角色模型的 AssetBundle 命名为 character_assets。   打包 AssetBundles：  通过 BuildPipeline.BuildAssetBundles...</div></div></div></a><a class="pagination-related" href="/2026/01/29/GitLab%20vs%20GitHub/" title="GitLab vs GitHub"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-29</div><div class="info-item-2">GitLab vs GitHub</div></div><div class="info-2"><div class="info-item-1">GitLab vs GitHub：全面对比详解一、一句话概括核心区别GitHub &#x3D; 代码托管平台 + 社交协作网络GitLab &#x3D; 一体化 DevOps 平台 + 自托管能力  二、核心对比速查表   对比维度 GitHub GitLab 谁更适合    核心定位 代码社交平台 完整 DevOps 平台 看需求   部署方式 仅云端 SaaS SaaS + 自托管 GitLab 灵活   商业模式 免费+付费 SaaS 免费自托管+付费 SaaS 各有所长   CI&#x2F;CD GitHub Actions GitLab CI&#x2F;CD GitLab 更强   项目管理 Issues+Projects 完整项目群组 GitLab 完整   安全功能 基础安全扫描 全生命周期安全 GitLab 全面   社区生态 全球最大 快速增长 GitHub 领先   企业特性 GitHub Enterprise GitLab Ultimate GitLab 更专业    三、详细对比分析1....</div></div></div></a><a class="pagination-related" href="/2025/05/12/Github-Hexo%20%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/" title="Github-Hexo 部署脚本"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">Github-Hexo 部署脚本</div></div><div class="info-2"><div class="info-item-1">位置 根目录，不然是不会有action记录，不会执行 token方式  ，推荐使用GITHUB_TOKEN 分支 相对路径： working-directory: blog，一般不用指定，我是因为创建一层父文件夹隔离导致无法正常访问才不得已需要它 只要你把 GitHub Actions 的 .yml 文件放在 .github&#x2F;workflows&#x2F; 目录下，GitHub 就会自动识别并执行这个工作流，无论文件名是 deploy1.yml、deploy.yml 还是其他名字。  代码1：旧 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556name: Deploy Hexo to GitHub Pageson:  push:    branches:      - masterjobs:  build:    runs-on: ubuntu-latest    steps:      - name:...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">LiuCheng</div><div class="author-info-description">不积跬步无以至千里</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">64</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">46</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Mr-liu-cheng"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://mr-liu-cheng.github.io/img/weixin.jpg" target="_blank" title="WeChat"><i class="fa-brands fa-weixin" style="color: #00ff00;"></i></a><a class="social-icon" href="mailto:liuchengyg@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://mr-liu-cheng.github.io/img/qq.jpg" target="_blank" title="QQ"><i class="fa-brands fa-qq" style="color: #ffffff;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Stay hungry, stay foolish.</div></div><div class="card-widget study-widget" id="study-list"><div class="item-headline"><i class="fas fa-tasks"></i><span>学习目标</span></div><div class="item-content"><div>
  <ul>
    <li>Shader</li>
    <li>华佗热更新</li>
    <li>微信游戏发布</li>
    <li>Steam游戏发布</li>
    <li>广告SDK接入</li>
  </ul>
</div>
</div></div><div class="card-widget calendar-widget" id="calendar-list"><div class="item-headline"><i class="fas fa-tasks"></i><span>今日事今日毕</span></div><div class="item-content"><head>
    <meta charset="UTF-8">
    <title>FullCalendar 农历和调休示例</title>
    <script src='https://cdn.jsdelivr.net/npm/rrule@2.6.4/dist/es5/rrule.min.js'></script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@latest/main.min.css" rel="stylesheet" />
</head>

<body>
    <a href="/Calendar/">
        <!-- 日历容器 -->
        <div id="calendar_aside"></div>
        <!-- FullCalendar JavaScript -->
        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@latest/main.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
        <!-- 引入农历库 -->
        <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@latest/lunar.min.js"></script>
        <!-- 本地脚本加载路径需要添加根目录节点-->
        <script src="/js/myCalendar.js"></script>
        <script>
            Show("calendar_aside");
        </script>
    </a>
</body>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#GitHub-%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%EF%BC%88GitHub-Container-Registry%EF%BC%89%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">GitHub 容器镜像（GitHub Container Registry）详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81GitHub-%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E6%80%BB%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">一、GitHub 容器镜像服务总览</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-GitHub-%E6%8F%90%E4%BE%9B%E7%9A%84%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.1.1.</span> <span class="toc-text">1. GitHub 提供的容器服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-GitHub-Container-Registry-GHCR-%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.2.</span> <span class="toc-text">2. GitHub Container Registry (GHCR) 特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%B8%89%E7%A7%8D%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">二、三种创建容器镜像的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F1%EF%BC%9A%E4%BD%BF%E7%94%A8-GitHub-Actions-%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">1.2.1.</span> <span class="toc-text">方式1：使用 GitHub Actions 自动构建（推荐）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F2%EF%BC%9A%E6%9C%AC%E5%9C%B0%E6%9E%84%E5%BB%BA%E5%90%8E%E6%89%8B%E5%8A%A8%E6%8E%A8%E9%80%81"><span class="toc-number">1.2.2.</span> <span class="toc-text">方式2：本地构建后手动推送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F3%EF%BC%9A%E5%A4%9A%E6%9E%B6%E6%9E%84%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%EF%BC%88ARM-AMD%EF%BC%89"><span class="toc-number">1.2.3.</span> <span class="toc-text">方式3：多架构镜像构建（ARM&#x2F;AMD）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%8C%E6%95%B4%E5%AE%9E%E6%88%98%E7%A4%BA%E4%BE%8B%EF%BC%9AUnity-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-number">1.3.</span> <span class="toc-text">三、完整实战示例：Unity 构建镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Dockerfile-%E7%A4%BA%E4%BE%8B%EF%BC%9AUnity-%E6%9E%84%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. Dockerfile 示例：Unity 构建环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-GitHub-Actions-%E5%B7%A5%E4%BD%9C%E6%B5%81%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.2.</span> <span class="toc-text">2. GitHub Actions 工作流配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.3.</span> <span class="toc-text">3. 多阶段构建优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81GitHub-Packages-%E4%B8%8E-GHCR-%E5%AF%B9%E6%AF%94"><span class="toc-number">1.4.</span> <span class="toc-text">四、GitHub Packages 与 GHCR 对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AF%B9%E6%AF%94%E8%A1%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">功能对比表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%81%E7%A7%BB%E6%8C%87%E5%8D%97%EF%BC%9A%E4%BB%8E-Docker-Hub-%E5%88%B0-GHCR"><span class="toc-number">1.4.2.</span> <span class="toc-text">迁移指南：从 Docker Hub 到 GHCR</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">五、访问控制与权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. 访问令牌类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. 权限配置示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BB%84%E7%BB%87%E7%BA%A7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.5.3.</span> <span class="toc-text">3. 组织级权限管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86%E4%B8%8E%E7%BB%B4%E6%8A%A4"><span class="toc-number">1.6.</span> <span class="toc-text">六、镜像管理与维护</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A0%87%E7%AD%BE%E7%AD%96%E7%95%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.6.1.</span> <span class="toc-text">1. 标签策略最佳实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%87%AA%E5%8A%A8%E6%B8%85%E7%90%86%E6%97%A7%E9%95%9C%E5%83%8F"><span class="toc-number">1.6.2.</span> <span class="toc-text">2. 自动清理旧镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%89%AB%E6%8F%8F"><span class="toc-number">1.6.3.</span> <span class="toc-text">3. 镜像安全扫描</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.</span> <span class="toc-text">七、高级使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%B7%A8%E4%BB%93%E5%BA%93%E5%85%B1%E4%BA%AB%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F"><span class="toc-number">1.7.1.</span> <span class="toc-text">1. 跨仓库共享基础镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%E5%8A%A0%E9%80%9F%E6%9E%84%E5%BB%BA"><span class="toc-number">1.7.2.</span> <span class="toc-text">2. 使用缓存加速构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%A4%9A%E4%BA%91%E9%83%A8%E7%BD%B2%E7%AD%96%E7%95%A5"><span class="toc-number">1.7.3.</span> <span class="toc-text">3. 多云部署策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%88%90%E6%9C%AC%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-number">1.8.</span> <span class="toc-text">八、成本优化策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%95%9C%E5%83%8F%E5%B1%82%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7"><span class="toc-number">1.8.1.</span> <span class="toc-text">1. 镜像层优化技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AD%98%E5%82%A8%E6%88%90%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">1.8.2.</span> <span class="toc-text">2. 存储成本控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BC%A0%E8%BE%93%E6%88%90%E6%9C%AC%E4%BC%98%E5%8C%96"><span class="toc-number">1.8.3.</span> <span class="toc-text">3. 传输成本优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E4%B8%8E%E7%9B%91%E6%8E%A7"><span class="toc-number">1.9.</span> <span class="toc-text">九、故障排查与监控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="toc-number">1.9.1.</span> <span class="toc-text">1. 常见问题解决</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87"><span class="toc-number">1.9.2.</span> <span class="toc-text">2. 监控指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%97%A5%E5%BF%97%E4%B8%8E%E8%B0%83%E8%AF%95"><span class="toc-number">1.9.3.</span> <span class="toc-text">3. 日志与调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E5%AE%8C%E6%95%B4%E5%AE%9E%E6%88%98%E5%B7%A5%E4%BD%9C%E6%B5%81"><span class="toc-number">1.10.</span> <span class="toc-text">十、完整实战工作流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%95%9C%E5%83%8F%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-number">1.10.1.</span> <span class="toc-text">企业级镜像流水线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B8%85%E5%8D%95%E6%80%BB%E7%BB%93"><span class="toc-number">1.10.2.</span> <span class="toc-text">配置清单总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.11.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/30/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87/" title="分布式游戏服务器架构开发准备">分布式游戏服务器架构开发准备</a><time datetime="2026-01-30T10:28:46.000Z" title="发表于 2026-01-30 10:28:46">2026-01-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/30/%E6%B8%B8%E6%88%8F%E7%83%AD%E6%9B%B4%E8%B5%84%E6%BA%90%E5%AD%98%E5%82%A8%E4%B8%8E%E5%88%86%E5%8F%91%E7%B3%BB%E7%BB%9F/" title="游戏热更资源存储与分发系统">游戏热更资源存储与分发系统</a><time datetime="2026-01-30T10:28:46.000Z" title="发表于 2026-01-30 10:28:46">2026-01-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/29/GitHub%20%E6%89%93%E9%95%9C%E5%83%8F/" title="GitHub 打镜像">GitHub 打镜像</a><time datetime="2026-01-29T12:06:02.000Z" title="发表于 2026-01-29 12:06:02">2026-01-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/29/GitLab%20vs%20GitHub/" title="GitLab vs GitHub">GitLab vs GitHub</a><time datetime="2026-01-29T12:06:02.000Z" title="发表于 2026-01-29 12:06:02">2026-01-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/29/Harbor-%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/" title="Harbor-企业级容器镜像仓库">Harbor-企业级容器镜像仓库</a><time datetime="2026-01-29T12:06:02.000Z" title="发表于 2026-01-29 12:06:02">2026-01-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2026 By LiuCheng</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="music-button" type="button" title="music"><i class="fas fa-music"> </i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = {"language":"zh-CN","distractionFreeMode":true}

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: 'Ov23lisuIzc4KST5xLzO',
      clientSecret: '55972644d3071dd4c51a2e71064e336d2f51aa66',
      repo: 'mr-liu-cheng.github.io',
      owner: 'Mr-liu-cheng',
      admin: ['Mr-liu-cheng'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || 'ef02cd5a441bce2f6fa6d316e9a96481'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><div id="music-player" style="display: none;"></div><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script>  fetch("/music/playlist.json")    .then(response => response.json())    .then(data => {      const ap = new APlayer({        container: document.getElementById("music-player"),        fixed: true,        autoplay: false,        audio: data,        lrcType: 3      });    })    .catch(error => console.error("Error loading playlist:", error));</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>